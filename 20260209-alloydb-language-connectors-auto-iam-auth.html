<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AlloyDB Language Connectors - Auto IAM Authentication & Managed Connection Pooling</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap');

    :root {
      --gc-blue: #4285F4;
      --gc-red: #EA4335;
      --gc-yellow: #FBBC04;
      --gc-green: #34A853;
      --gc-blue-900: #174EA6;
      --gc-blue-800: #185ABC;
      --gc-blue-700: #1967D2;
      --gc-blue-600: #1A73E8;
      --gc-blue-500: #4285F4;
      --gc-blue-300: #669DF6;
      --gc-blue-200: #8AB4F8;
      --gc-blue-100: #AECBFA;
      --gc-blue-50: #E8F0FE;
      --gc-on-surface: #202124;
      --gc-on-surface-variant: #5F6368;
      --gc-outline: #80868B;
      --gc-surface: #FFFFFF;
      --gc-surface-container-lowest: #F8F9FA;
      --gc-surface-container-low: #F1F3F4;
      --gc-surface-container: #E8EAED;
      --gc-outline-variant: #DADCE0;
      --gc-blue-tint: #E8F0FE;
      --gc-green-tint: #E6F4EA;
      --gc-red-tint: #FCE8E6;
      --gc-yellow-tint: #FEF7E0;
      --gc-purple-tint: #F3E8FD;
      --gc-teal-tint: #E0F7FA;
      --gc-purple: #A142F4;
      --gc-teal: #00BCD4;
      --gc-orange: #FF6D00;
    }

    * { box-sizing: border-box; }

    body {
      background-color: var(--gc-surface);
      font-family: 'Google Sans', 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      color: var(--gc-on-surface-variant);
      font-size: 16px;
      line-height: 1.7;
      padding: 20px;
      margin: 0;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      width: 100%;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 32px;
      flex-wrap: wrap;
      padding-bottom: 16px;
      border-bottom: 3px solid var(--gc-blue-600);
    }

    .header-left { flex: 1; min-width: 280px; }

    h1 {
      font-size: 32px;
      font-weight: 700;
      color: var(--gc-on-surface);
      margin: 0 0 8px 0;
      line-height: 1.3;
    }

    h2 {
      font-size: 24px;
      font-weight: 600;
      color: var(--gc-on-surface);
      margin: 0 0 16px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--gc-blue-600);
    }

    h3 {
      font-size: 18px;
      font-weight: 600;
      color: var(--gc-on-surface);
      margin: 16px 0 8px 0;
    }

    .subtitle {
      font-size: 16px;
      color: var(--gc-outline);
      text-align: right;
      white-space: nowrap;
    }

    .section {
      background: var(--gc-surface-container-low);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--gc-outline-variant);
    }

    .highlight {
      background-color: var(--gc-blue-50);
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
      color: var(--gc-blue-800);
      border-bottom: 2px solid var(--gc-blue-600);
    }

    .card {
      background: var(--gc-surface);
      border-radius: 12px;
      padding: 20px;
      margin: 12px 0;
      border-left: 4px solid var(--gc-blue-600);
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.12), 0 1px 2px rgba(60, 64, 67, 0.08);
    }

    .card h3 { margin-top: 0; }

    .badge {
      display: inline-block;
      color: #FFFFFF;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.25px;
      margin: 4px 8px 4px 0;
      background: var(--gc-blue-600);
    }

    .badge-fixed {
      display: inline-block;
      color: #FFFFFF;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.25px;
      margin: 4px 8px 4px 0;
      background: var(--gc-green);
    }

    .badge-service {
      display: inline-block;
      color: #FFFFFF;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.25px;
      margin: 4px 8px 4px 0;
      background: #F4B400;
    }

    /* Before/After */
    .before-after { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 16px 0; }
    .before-box {
      background: var(--gc-red-tint);
      border-left: 4px solid var(--gc-red);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
    }
    .after-box {
      background: var(--gc-green-tint);
      border-left: 4px solid var(--gc-green);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
    }
    .before-box h4, .after-box h4 { margin: 0 0 8px 0; font-size: 15px; }
    .before-box ul, .after-box ul { margin: 0; padding-left: 20px; }
    .before-box li, .after-box li { margin: 4px 0; font-size: 14px; }

    @media (max-width: 600px) {
      .before-after { grid-template-columns: 1fr; }
    }

    /* Stats */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 16px 0; }
    .stat-card {
      background: linear-gradient(135deg, var(--gc-blue-600), var(--gc-blue-800));
      color: var(--gc-surface);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
    }
    .stat-value { font-size: 32px; font-weight: 700; margin-bottom: 4px; }
    .stat-label { font-size: 14px; opacity: 0.9; }

    /* Feature cards grid */
    .feature-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--gc-outline-variant);
    }
    th {
      background: var(--gc-blue-50);
      color: var(--gc-blue-900);
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      border-bottom: 2px solid var(--gc-blue-200);
    }
    td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--gc-outline-variant);
      font-size: 14px;
    }
    tr:nth-child(even) { background: var(--gc-surface-container-lowest); }
    tr:hover { background: var(--gc-blue-50); }

    /* Note/Warning boxes */
    .note-box {
      background: var(--gc-blue-tint);
      border-left: 4px solid var(--gc-blue-600);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }
    .warning-box {
      background: var(--gc-yellow-tint);
      border-left: 4px solid var(--gc-yellow);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }
    .error-box {
      background: var(--gc-red-tint);
      border-left: 4px solid var(--gc-red);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }
    .success-box {
      background: var(--gc-green-tint);
      border-left: 4px solid var(--gc-green);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }

    /* Use case cards */
    .usecase-card {
      background: var(--gc-blue-tint);
      border-radius: 12px;
      padding: 20px;
      margin: 12px 0;
      border: 1px solid var(--gc-blue-200);
    }
    .usecase-card h3 { margin-top: 0; color: var(--gc-blue-900); }

    /* Code blocks */
    .code-block {
      background: #1E1E1E;
      border-radius: 8px;
      overflow: hidden;
      margin: 16px 0;
    }
    .code-header {
      background: #2D2D2D;
      padding: 8px 16px;
      display: flex;
      justify-content: space-between;
      font-size: 12px;
    }
    .code-lang { color: #9CDCFE; font-weight: bold; }
    .code-title { color: #AAAAAA; }
    .code-block pre {
      margin: 0;
      padding: 0;
      overflow-x: auto;
      background: #1E1E1E;
      border-radius: 0;
    }
    .code-block code {
      font-family: 'Roboto Mono', 'Source Code Pro', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      padding: 16px !important;
    }

    pre:not(.mermaid) {
      background: #1E1E1E;
      border-radius: 8px;
      padding: 16px;
      font-family: 'Roboto Mono', 'Source Code Pro', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      overflow-x: auto;
      color: #E8E8E8;
      margin: 16px 0;
    }

    pre code {
      background: none;
      border: none;
      padding: 0;
      font-size: inherit;
      color: inherit;
    }

    code:not(pre code) {
      background: var(--gc-surface-container-low);
      border: 1px solid var(--gc-outline-variant);
      border-radius: 4px;
      padding: 2px 6px;
      font-family: 'Roboto Mono', 'Source Code Pro', 'Courier New', monospace;
      font-size: 0.9em;
      color: var(--gc-blue-900);
    }

    /* Mermaid */
    .mermaid-container {
      background: #FFFFFF;
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
      border: 2px solid rgba(66, 133, 244, 0.3);
      overflow-x: auto;
    }
    .mermaid {
      display: flex;
      justify-content: center;
    }

    /* Flow diagram */
    .flow-diagram {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      margin: 24px 0;
    }
    .flow-step {
      background: var(--gc-surface);
      border: 2px solid var(--gc-blue-600);
      border-radius: 12px;
      padding: 12px 20px;
      text-align: center;
      min-width: 100px;
      color: var(--gc-on-surface);
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.12);
    }
    .flow-arrow {
      color: var(--gc-blue-600);
      font-size: 24px;
      font-weight: bold;
    }

    /* Check items */
    .check-item { display: flex; align-items: flex-start; gap: 8px; margin: 8px 0; }
    .check-icon { color: var(--gc-green); font-size: 18px; flex-shrink: 0; }
    .cross-icon { color: var(--gc-red); font-size: 18px; flex-shrink: 0; }

    /* Links */
    .gc-link { color: var(--gc-blue-600); text-decoration: none; }
    .gc-link:hover { color: var(--gc-blue-800); text-decoration: underline; }

    /* Pricing card */
    .pricing-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin: 16px 0; }
    .pricing-card {
      background: var(--gc-surface);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--gc-outline-variant);
      text-align: center;
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.12);
    }
    .pricing-card.recommended {
      border: 2px solid var(--gc-blue-600);
      position: relative;
    }
    .pricing-value { font-size: 28px; font-weight: 700; color: var(--gc-blue-800); margin: 8px 0; }
    .pricing-label { font-size: 13px; color: var(--gc-outline); }
    .pricing-discount { font-size: 14px; font-weight: 600; color: var(--gc-green); }

    /* Related services */
    .related-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; margin: 16px 0; }
    .related-card {
      background: var(--gc-surface);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid var(--gc-outline-variant);
    }
    .related-card strong { color: var(--gc-on-surface); }

    footer {
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid var(--gc-outline-variant);
      font-size: 12px;
      color: var(--gc-outline);
    }
    footer a { color: var(--gc-blue-600); text-decoration: underline; word-break: break-all; }
    footer ul { list-style: none; padding: 0; margin: 8px 0; }
    footer li { margin: 4px 0; }

    @media (max-width: 600px) {
      h1 { font-size: 24px; }
      .header { flex-direction: column; }
      .subtitle { text-align: left; margin-top: 8px; }
      .stats-grid { grid-template-columns: 1fr; }
      .pricing-grid { grid-template-columns: 1fr; }
      .related-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <h1>&#x1f5c3;&#xfe0f; AlloyDB for PostgreSQL: Language Connectors の Auto IAM Authentication と Managed Connection Pooling 対応</h1>
        <div style="margin-top: 8px;">
          <span class="badge-service">AlloyDB for PostgreSQL</span>
          <span class="badge-fixed">FIXED</span>
          <span class="badge">Language Connectors</span>
          <span class="badge">Auth Proxy</span>
        </div>
      </div>
      <div class="subtitle">2026-02-09</div>
    </div>

    <!-- Overview -->
    <div class="section">
      <h2>&#x1f4cb; 概要</h2>
      <p>AlloyDB for PostgreSQL の <span class="highlight">Language Connectors</span> および <span class="highlight">Auth Proxy</span> において、<span class="highlight">Auto IAM Authentication</span> と <span class="highlight">Managed Connection Pooling</span> のサポートに関する修正がリリースされました。この修正はメンテナンスバージョン <strong>20260107.02_05</strong> 以降で利用可能です。</p>
      <p>AlloyDB Language Connectors (Java, Python, Go) と Auth Proxy は、アプリケーションから AlloyDB インスタンスへの安全な接続を確立するためのライブラリおよびプロキシツールです。今回の修正により、これらのコネクタを通じた Auto IAM Authentication と Managed Connection Pooling の組み合わせがより安定的に動作するようになりました。</p>

      <div class="before-after">
        <div class="before-box">
          <h4>&#x274c; アップデート前の課題</h4>
          <ul>
            <li>Language Connectors や Auth Proxy で Auto IAM Authentication と Managed Connection Pooling を組み合わせて使用する際に問題が発生</li>
            <li>メンテナンスウィンドウの設定によっては、最新の修正が自動的に適用されるまでに時間がかかる場合があった</li>
            <li>IAM 認証を使用したコネクションプーリング接続の安定性に課題</li>
          </ul>
        </div>
        <div class="after-box">
          <h4>&#x2705; アップデート後の改善</h4>
          <ul>
            <li>メンテナンスバージョン 20260107.02_05 で Auto IAM Authentication と Managed Connection Pooling の問題が修正</li>
            <li>セルフサービスメンテナンスにより、メンテナンスウィンドウを待たずに即座にアップデートを適用可能</li>
            <li>Language Connectors (Java, Python, Go) と Auth Proxy の両方で修正が適用され、接続の安定性が向上</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value">3</div>
        <div class="stat-label">対応言語<br>(Java / Python / Go)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">262,042</div>
        <div class="stat-label">最大同時クライアント接続数<br>(Managed Connection Pooling)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">mTLS 1.3</div>
        <div class="stat-label">暗号化通信<br>(256-bit AES)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">6432</div>
        <div class="stat-label">Connection Pooler<br>ポート番号</div>
      </div>
    </div>

    <!-- Architecture Diagram (Mermaid) -->
    <div class="section">
      <h2>&#x1f3d7;&#xfe0f; アーキテクチャ図</h2>
      <p>AlloyDB Language Connectors と Auth Proxy は IAM 認証を通じてアクセストークンを自動取得し、Managed Connection Pooler を経由して AlloyDB データベースに mTLS で安全に接続します。Connection Pooler はクライアント接続をサーバー接続にマッピングし、リソース効率を最適化します。</p>
      <div class="mermaid-container">
        <pre class="mermaid">
flowchart TD
    subgraph Client["クライアント環境"]
        App["アプリケーション"]
        LC["Language Connectors\n(Java / Python / Go)"]
        AP["Auth Proxy\n--auto-iam-authn"]
    end

    subgraph IAM["Google Cloud IAM"]
        IAMAuth["IAM 認証\n(Auto IAM AuthN)"]
        Token["OAuth 2.0\nアクセストークン"]
    end

    subgraph AlloyDB["AlloyDB インスタンス"]
        Pooler["Managed Connection Pooler\n(ポート 6432)"]
        DB["AlloyDB データベース\n(ポート 5433)"]
    end

    App --> LC
    App --> AP
    LC --> IAMAuth
    AP --> IAMAuth
    IAMAuth --> Token
    Token --> LC
    Token --> AP
    LC -- "mTLS 1.3\n(256-bit AES)" --> Pooler
    AP -- "mTLS 1.3\n(256-bit AES)" --> Pooler
    Pooler -- "プール済み接続\n(トランザクション/セッション)" --> DB
        </pre>
      </div>
    </div>

    <!-- Key Features -->
    <div class="section">
      <h2>&#x2699;&#xfe0f; 主要機能</h2>
      <div class="feature-grid">
        <div class="card">
          <h3>&#x1f510; Auto IAM Authentication (自動 IAM 認証)</h3>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>IAM プリンシパルの認証情報を使用して、アクセストークンの取得と管理をコネクタに委任</span></div>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>アプリケーションは IAM データベースユーザー名のみを接続リクエストに渡すだけでよい</span></div>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>コネクタがクライアントに代わってパスワード属性のアクセストークン情報を送信</span></div>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>パスワード管理が不要になり、IAM によるアクセス制御の一元管理が可能</span></div>
        </div>
        <div class="card">
          <h3>&#x1f4a7; Managed Connection Pooling (マネージドコネクションプーリング)</h3>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>AlloyDB がネイティブに提供するコネクションプーリング機能</span></div>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>プリエスタブリッシュされた接続のプールを維持し、接続の開閉オーバーヘッドを削減</span></div>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>トランザクションモードとセッションモードの 2 つのプーリングモードを選択可能</span></div>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>ポート 6432 で接続を受け付け、最大 262,042 の同時クライアント接続をサポート</span></div>
        </div>
        <div class="card">
          <h3>&#x1f517; Language Connectors (言語コネクタ)</h3>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>AlloyDB Java Connector, Python Connector, Go Connector の 3 言語に対応</span></div>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>自動 mTLS (TLS 1.3) 接続によるセキュアな通信</span></div>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>IAM ベースの認可サポート</span></div>
          <div class="check-item"><span class="check-icon">&#x2713;</span><span>Private IP, Public IP, Private Service Connect の各接続方式に対応</span></div>
        </div>
      </div>
    </div>

    <!-- Maintenance Version -->
    <div class="section">
      <h2>&#x1f527; メンテナンスバージョンの適用</h2>
      <p>今回の修正はメンテナンスバージョン <span class="highlight">20260107.02_05</span> で提供されています。</p>
      <div class="flow-diagram">
        <div class="flow-step">&#x1f50d; バージョン確認<br><small>gcloud alloydb clusters describe</small></div>
        <span class="flow-arrow">&#x2192;</span>
        <div class="flow-step">&#x26a0;&#xfe0f; 適用判断<br><small>ウィンドウ or セルフサービス</small></div>
        <span class="flow-arrow">&#x2192;</span>
        <div class="flow-step">&#x1f504; アップデート実行<br><small>--trigger-maintenance</small></div>
        <span class="flow-arrow">&#x2192;</span>
        <div class="flow-step">&#x2705; 修正適用完了<br><small>通常 1 時間以内</small></div>
      </div>
      <div style="margin-top: 12px;">
        <div class="check-item"><span class="check-icon">&#x2713;</span><span><strong>ウィンドウ未設定クラスタ</strong>: リージョン営業時間外に自動適用</span></div>
        <div class="check-item"><span class="check-icon">&#x2713;</span><span><strong>ウィンドウ設定済みクラスタ</strong>: 設定されたウィンドウに従って適用</span></div>
        <div class="check-item"><span class="check-icon">&#x2713;</span><span><strong>即座に適用が必要な場合</strong>: セルフサービスメンテナンスを実行</span></div>
      </div>
    </div>

    <!-- Technical Specs -->
    <div class="section">
      <h2>&#x1f4ca; 技術仕様</h2>

      <h3>Managed Connection Pooling の設定パラメータ</h3>
      <table>
        <thead>
          <tr><th>パラメータ</th><th>デフォルト値</th><th>説明</th></tr>
        </thead>
        <tbody>
          <tr><td>Connection mode</td><td>transaction</td><td>トランザクション単位またはセッション単位のプーリング</td></tr>
          <tr><td>Maximum pool size</td><td>50</td><td>ユーザー/データベースペアあたりの最大プールサイズ</td></tr>
          <tr><td>Minimum pool size</td><td>0</td><td>プールの最小サイズ</td></tr>
          <tr><td>Maximum client connections</td><td>5,000</td><td>同時クライアント接続の最大数 (最大 262,042)</td></tr>
          <tr><td>Idle client connection timeout</td><td>0 秒</td><td>クライアント接続のアイドルタイムアウト</td></tr>
          <tr><td>Idle server connection timeout</td><td>600 秒</td><td>サーバー接続のアイドルタイムアウト</td></tr>
          <tr><td>Query wait timeout</td><td>120 秒</td><td>クエリ待機タイムアウト</td></tr>
          <tr><td>Server lifetime</td><td>3,600 秒</td><td>サーバー接続の最大存続時間</td></tr>
        </tbody>
      </table>

      <h3>IAM 認証に必要なロール</h3>
      <table>
        <thead>
          <tr><th>必要なロール</th><th>説明</th></tr>
        </thead>
        <tbody>
          <tr><td><code>roles/alloydb.client</code></td><td>AlloyDB Client ロール (接続権限)</td></tr>
          <tr><td><code>roles/serviceusage.serviceUsageConsumer</code></td><td>Service Usage Consumer ロール</td></tr>
          <tr><td><code>roles/alloydb.admin</code></td><td>Managed Connection Pooling の有効化に必要</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Setup Steps -->
    <div class="section">
      <h2>&#x1f6e0;&#xfe0f; 設定方法</h2>

      <h3>前提条件</h3>
      <div class="check-item"><span class="check-icon">&#x2713;</span><span>AlloyDB API が有効化されていること</span></div>
      <div class="check-item"><span class="check-icon">&#x2713;</span><span>AlloyDB インスタンスが作成済みであること</span></div>
      <div class="check-item"><span class="check-icon">&#x2713;</span><span>IAM ユーザーに <code>roles/alloydb.client</code> と <code>roles/serviceusage.serviceUsageConsumer</code> ロールが付与されていること</span></div>
      <div class="check-item"><span class="check-icon">&#x2713;</span><span>Managed Connection Pooling の管理には <code>roles/alloydb.admin</code> ロールが必要</span></div>

      <h3>ステップ 1: メンテナンスバージョンの確認と適用</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">クラスタのメンテナンス状態確認 & セルフサービスメンテナンス</span>
        </div>
        <pre><code class="language-bash"># クラスタのメンテナンス状態を確認
gcloud alloydb clusters describe CLUSTER_ID \
  --region=REGION_ID

# セルフサービスメンテナンスを実行 (最新バージョンに更新)
gcloud alloydb clusters update CLUSTER_ID \
  --region=REGION_ID \
  --trigger-maintenance</code></pre>
      </div>

      <h3>ステップ 2: Managed Connection Pooling の有効化</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">既存インスタンスで Managed Connection Pooling を有効化</span>
        </div>
        <pre><code class="language-bash"># 既存インスタンスで Managed Connection Pooling を有効化
gcloud alloydb instances update INSTANCE_ID \
  --project=PROJECT_ID \
  --region=REGION_ID \
  --cluster=CLUSTER_ID \
  --enable-connection-pooling</code></pre>
      </div>

      <div class="note-box">
        <strong>&#x1f4a1; ヒント:</strong> Managed Connection Pooling はデフォルトで無効になっています。明示的に有効化する必要があります。
      </div>

      <h3>ステップ 3: Auto IAM Authentication を使用した接続</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">Auth Proxy + Auto IAM Authentication + Connection Pooling</span>
        </div>
        <pre><code class="language-bash"># Auth Proxy を Auto IAM Authentication で起動
./alloydb-auth-proxy \
  "projects/PROJECT_ID/locations/REGION_ID/clusters/CLUSTER_ID/instances/INSTANCE_ID" \
  --auto-iam-authn

# Managed Connection Pooling ポート (6432) に接続
psql "host=127.0.0.1 port=6432 dbname=postgres user=IAM_USER@PROJECT_ID.iam sslmode=disable"</code></pre>
      </div>
    </div>

    <!-- Code Samples -->
    <div class="section">
      <h2>&#x1f4dd; コードサンプル</h2>

      <h3>Language Connectors の接続例 (Python / pg8000 / Auto IAM AuthN)</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Python</span>
          <span class="code-title">Auto IAM Authentication を使用した AlloyDB 接続</span>
        </div>
        <pre><code class="language-python">from google.cloud.alloydb.connector import Connector

# Auto IAM Authentication を有効にしたコネクタの初期化
connector = Connector()

def getconn():
    conn = connector.connect(
        "projects/my-project/locations/us-central1/clusters/my-cluster/instances/my-instance",
        "pg8000",
        user="iam-user@my-project.iam",
        enable_iam_auth=True,
        db="mydb",
    )
    return conn</code></pre>
      </div>

      <h3>Auth Proxy の起動例 (Auto IAM AuthN 有効)</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">Auth Proxy の起動コマンド</span>
        </div>
        <pre><code class="language-bash"># Auto IAM Authentication を有効にして Auth Proxy を起動
./alloydb-auth-proxy \
  "projects/PROJECT_ID/locations/REGION/clusters/CLUSTER_ID/instances/INSTANCE_ID" \
  --auto-iam-authn</code></pre>
      </div>
    </div>

    <!-- Benefits -->
    <div class="section">
      <h2>&#x1f4c8; メリット</h2>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
        <div>
          <h3>&#x1f4bc; ビジネス面</h3>
          <div class="card" style="border-left-color: var(--gc-green);">
            <div class="check-item"><span class="check-icon">&#x2713;</span><span><strong>運用コスト削減</strong>: IAM による認証の一元管理により、データベース固有のパスワード管理が不要になり、セキュリティ運用の負荷を軽減</span></div>
            <div class="check-item"><span class="check-icon">&#x2713;</span><span><strong>スケーラビリティ向上</strong>: Managed Connection Pooling により、急激な接続スパイクを吸収し、アプリケーションの安定稼働を維持</span></div>
          </div>
        </div>
        <div>
          <h3>&#x2699;&#xfe0f; 技術面</h3>
          <div class="card" style="border-left-color: var(--gc-blue);">
            <div class="check-item"><span class="check-icon">&#x2713;</span><span><strong>セキュリティ強化</strong>: Auto IAM Authentication により、パスワードではなく一時的なアクセストークンを使用した認証が実現され、認証情報漏洩のリスクが軽減</span></div>
            <div class="check-item"><span class="check-icon">&#x2713;</span><span><strong>接続効率の最適化</strong>: コネクションプーリングによりサーバーリソースの利用効率が向上し、短命な接続が多いワークロードで特に効果を発揮</span></div>
            <div class="check-item"><span class="check-icon">&#x2713;</span><span><strong>柔軟なメンテナンス管理</strong>: セルフサービスメンテナンスにより、修正パッチの適用タイミングを管理者が制御可能</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Limitations -->
    <div class="section">
      <h2>&#x26a0;&#xfe0f; デメリット・制約事項</h2>

      <h3>制限事項</h3>
      <div class="error-box">
        <div class="check-item"><span class="cross-icon">&#x2717;</span><span>Managed Connection Pooling は <strong>Public IP 接続ではサポートされていない</strong></span></div>
        <div class="check-item"><span class="cross-icon">&#x2717;</span><span>トランザクションプーリングモードでは、SET/RESET, LISTEN, WITH HOLD CURSOR, PREPARE/DEALLOCATE, セッションレベルアドバイザリロック, Protocol-level prepared plans などの SQL 機能が使用不可</span></div>
        <div class="check-item"><span class="cross-icon">&#x2717;</span><span>REPLICATION ロールを持つユーザーからの接続は Managed Connection Pooling ではサポートされていない</span></div>
      </div>

      <h3>考慮すべき点</h3>
      <div class="warning-box">
        <div class="check-item"><span style="color: var(--gc-yellow); font-size: 18px; flex-shrink: 0;">&#x26a0;</span><span>2024 年 11 月以前に作成された AlloyDB インスタンスで Managed Connection Pooling を有効化する場合、ネットワーク設定の一回限りの更新が必要 (VPC ネットワーク接続に通常 15 秒未満の短時間の中断が発生)</span></div>
        <div class="check-item"><span style="color: var(--gc-yellow); font-size: 18px; flex-shrink: 0;">&#x26a0;</span><span>メンテナンスバージョンの適用には、クラスタ内の全インスタンスの更新が必要で、通常 1 時間以内に完了</span></div>
        <div class="check-item"><span style="color: var(--gc-yellow); font-size: 18px; flex-shrink: 0;">&#x26a0;</span><span>コンテキストアウェアアクセスを IAM 構成で使用している場合、Auth Proxy や Language Connectors での IAM 認証は使用不可</span></div>
      </div>
    </div>

    <!-- Use Cases -->
    <div class="section">
      <h2>&#x1f4a1; ユースケース</h2>

      <div class="usecase-card">
        <h3>&#x1f3af; ユースケース 1: マイクロサービスアーキテクチャでの接続管理</h3>
        <p><strong>シナリオ</strong>: 多数のマイクロサービスが AlloyDB に短命な接続を頻繁に確立するアプリケーション環境。各サービスは Kubernetes 上で動作し、サービスアカウントを使用した IAM 認証を採用。</p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Bash</span>
            <span class="code-title">各マイクロサービスの Pod で Auth Proxy をサイドカーとして起動</span>
          </div>
          <pre><code class="language-bash"># 各マイクロサービスの Pod で Auth Proxy をサイドカーとして起動
./alloydb-auth-proxy \
  "projects/my-project/locations/us-central1/clusters/prod-cluster/instances/primary" \
  --auto-iam-authn \
  --port 6432

# アプリケーションは localhost:6432 に接続
# Managed Connection Pooling がサーバー側で接続を管理</code></pre>
        </div>
        <div class="success-box">
          <strong>&#x2705; 効果:</strong> 各マイクロサービスのデータベースパスワード管理が不要になり、コネクションプーリングにより接続オーバーヘッドが大幅に削減される。
        </div>
      </div>

      <div class="usecase-card">
        <h3>&#x1f3af; ユースケース 2: サーバーレスアプリケーションからの接続</h3>
        <p><strong>シナリオ</strong>: Cloud Run や Cloud Functions から AlloyDB に接続するサーバーレスアプリケーション。リクエストごとに接続が発生するため、コネクションプーリングが不可欠。</p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Python</span>
            <span class="code-title">サーバーレス環境での AlloyDB 接続</span>
          </div>
          <pre><code class="language-python">from google.cloud.alloydb.connector import Connector
import sqlalchemy

connector = Connector(refresh_strategy="lazy")  # サーバーレス環境では lazy を推奨

engine = sqlalchemy.create_engine(
    "postgresql+pg8000://",
    creator=lambda: connector.connect(
        "projects/my-project/locations/us-central1/clusters/my-cluster/instances/my-instance",
        "pg8000",
        user="sa@my-project.iam",
        enable_iam_auth=True,
        db="mydb",
    ),
)</code></pre>
        </div>
        <div class="success-box">
          <strong>&#x2705; 効果:</strong> サーバーレス環境でのコールドスタート時の接続遅延を最小化し、IAM サービスアカウントによるセキュアな認証を実現。
        </div>
      </div>
    </div>

    <!-- Pricing -->
    <div class="section">
      <h2>&#x1f4b0; 料金</h2>
      <p>AlloyDB for PostgreSQL は従量課金モデルを採用しています。<span class="highlight">Language Connectors, Auth Proxy, Managed Connection Pooling の使用自体に追加料金は発生しません</span>。AlloyDB の料金はインスタンスリソース (vCPU とメモリ), ストレージ, ネットワーク Egress に基づいて課金されます。</p>

      <h3>料金例 (16 vCPU / 128 GB RAM HA プライマリ, us-central1)</h3>
      <div class="pricing-grid">
        <div class="pricing-card">
          <div class="pricing-label">オンデマンド</div>
          <div class="pricing-value">~$3,635/月</div>
          <div class="pricing-label">割引なし</div>
        </div>
        <div class="pricing-card recommended">
          <div class="pricing-label">1 年 CUD</div>
          <div class="pricing-value">~$2,728/月</div>
          <div class="pricing-discount">25% 割引</div>
        </div>
        <div class="pricing-card">
          <div class="pricing-label">3 年 CUD</div>
          <div class="pricing-value">~$1,746/月</div>
          <div class="pricing-discount">52% 割引</div>
        </div>
      </div>
      <p style="font-size: 13px; color: var(--gc-outline);">詳細な料金情報は <a href="https://cloud.google.com/alloydb/pricing" target="_blank" class="gc-link">AlloyDB for PostgreSQL pricing</a> を参照してください。</p>
    </div>

    <!-- Related Services -->
    <div class="section">
      <h2>&#x1f517; 関連サービス・機能</h2>
      <div class="related-grid">
        <div class="related-card">
          <strong>&#x1f6e1;&#xfe0f; AlloyDB Auth Proxy</strong>
          <p style="font-size: 14px; margin: 8px 0 0 0;">アプリケーションと AlloyDB 間の認可済み暗号化接続を提供するプロキシ。Auto IAM Authentication に対応。</p>
        </div>
        <div class="related-card">
          <strong>&#x1f517; AlloyDB Language Connectors</strong>
          <p style="font-size: 14px; margin: 8px 0 0 0;">Java, Python, Go のライブラリで、mTLS 接続と IAM 認証を自動管理。</p>
        </div>
        <div class="related-card">
          <strong>&#x1f510; Cloud IAM</strong>
          <p style="font-size: 14px; margin: 8px 0 0 0;">AlloyDB インスタンスへのアクセス制御を一元管理。<code>roles/alloydb.client</code> ロールによる接続認可。</p>
        </div>
        <div class="related-card">
          <strong>&#x1f4ca; Cloud Monitoring</strong>
          <p style="font-size: 14px; margin: 8px 0 0 0;">Managed Connection Pooling のメトリクス (クライアント接続数, サーバー接続数, 平均待機時間) を監視可能。</p>
        </div>
        <div class="related-card">
          <strong>&#x1f310; VPC ネットワーク</strong>
          <p style="font-size: 14px; margin: 8px 0 0 0;">Private IP, Public IP, Private Service Connect による AlloyDB への接続経路を提供。</p>
        </div>
      </div>
    </div>

    <!-- Summary -->
    <div class="section">
      <h2>&#x1f4dd; まとめ</h2>
      <div class="note-box">
        <p>今回の修正 (メンテナンスバージョン <strong>20260107.02_05</strong>) により、AlloyDB Language Connectors および Auth Proxy における <span class="highlight">Auto IAM Authentication</span> と <span class="highlight">Managed Connection Pooling</span> の組み合わせ利用時の安定性が向上しました。</p>
        <p style="margin-top: 12px;">IAM 認証とコネクションプーリングを併用しているワークロードでは、<strong>セルフサービスメンテナンスを使用して速やかにアップデートを適用する</strong>ことを推奨します。メンテナンスウィンドウが設定されているクラスタは、ウィンドウの到来を待つか、セルフサービスメンテナンスで即座に適用するかを運用要件に応じて判断してください。</p>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <p><strong>&#x1f4ce; 出典:</strong></p>
      <ul>
        <li><a href="https://cloud.google.com/release-notes#February_09_2026" target="_blank" rel="noopener noreferrer">公式リリースノート (February 09, 2026)</a></li>
        <li><a href="https://cloud.google.com/alloydb/docs/connect-language-connectors" target="_blank" rel="noopener noreferrer">AlloyDB Language Connectors で接続する</a></li>
        <li><a href="https://cloud.google.com/alloydb/docs/language-connectors-overview" target="_blank" rel="noopener noreferrer">AlloyDB Language Connectors の概要</a></li>
        <li><a href="https://cloud.google.com/alloydb/docs/auth-proxy/overview" target="_blank" rel="noopener noreferrer">AlloyDB Auth Proxy の概要</a></li>
        <li><a href="https://cloud.google.com/alloydb/docs/configure-managed-connection-pooling" target="_blank" rel="noopener noreferrer">Managed Connection Pooling の構成</a></li>
        <li><a href="https://cloud.google.com/alloydb/docs/manage-iam-authn" target="_blank" rel="noopener noreferrer">IAM 認証の管理</a></li>
        <li><a href="https://cloud.google.com/alloydb/docs/self-service-maintenance" target="_blank" rel="noopener noreferrer">セルフサービスメンテナンス</a></li>
        <li><a href="https://cloud.google.com/alloydb/pricing" target="_blank" rel="noopener noreferrer">AlloyDB for PostgreSQL の料金</a></li>
      </ul>
      <p style="margin-top: 12px; font-size: 11px; color: var(--gc-outline);">#AlloyDB #PostgreSQL #IAM #Authentication #ConnectionPooling #LanguageConnectors #AuthProxy</p>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'base',
      themeVariables: {
        primaryColor: '#4285F4',
        primaryTextColor: '#202124',
        primaryBorderColor: '#4285F4',
        lineColor: '#4285F4',
        secondaryColor: '#F1F3F4',
        tertiaryColor: '#FAFAFA',
        background: '#FFFFFF',
        mainBkg: '#E8F0FE',
        nodeBorder: '#4285F4',
        clusterBkg: '#E8F0FE',
        clusterBorder: '#4285F4',
        edgeLabelBackground: '#FFFFFF',
        textColor: '#202124'
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</body>
</html>