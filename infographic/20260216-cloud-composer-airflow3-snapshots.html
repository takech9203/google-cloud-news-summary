<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cloud Composer: Airflow 3 環境スナップショット対応 - 2026-02-16</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap');

    /* Google Cloud Light Theme Base Styles */
    :root {
      --gc-blue: #4285F4;
      --gc-red: #EA4335;
      --gc-yellow: #FBBC04;
      --gc-green: #34A853;
      --gc-blue-900: #174EA6;
      --gc-blue-800: #185ABC;
      --gc-blue-700: #1967D2;
      --gc-blue-600: #1A73E8;
      --gc-blue-500: #4285F4;
      --gc-blue-300: #669DF6;
      --gc-blue-200: #8AB4F8;
      --gc-blue-100: #AECBFA;
      --gc-blue-50: #E8F0FE;
      --gc-on-surface: #202124;
      --gc-on-surface-variant: #5F6368;
      --gc-outline: #80868B;
      --gc-surface: #FFFFFF;
      --gc-surface-container-lowest: #F8F9FA;
      --gc-surface-container-low: #F1F3F4;
      --gc-surface-container: #E8EAED;
      --gc-outline-variant: #DADCE0;
      --gc-blue-tint: #E8F0FE;
      --gc-green-tint: #E6F4EA;
      --gc-red-tint: #FCE8E6;
      --gc-yellow-tint: #FEF7E0;
      --gc-purple-tint: #F3E8FD;
      --gc-teal-tint: #E0F7FA;
      --gc-purple: #A142F4;
      --gc-teal: #00BCD4;
      --gc-orange: #FF6D00;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background-color: var(--gc-surface);
      font-family: 'Google Sans', 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      color: var(--gc-on-surface-variant);
      font-size: 16px;
      line-height: 1.7;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      width: 100%;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 32px;
      flex-wrap: wrap;
      padding-bottom: 16px;
      border-bottom: 3px solid var(--gc-blue-600);
    }

    h1 {
      font-size: 32px;
      font-weight: 700;
      color: var(--gc-on-surface);
      margin: 0;
      line-height: 1.3;
    }

    h2 {
      font-size: 24px;
      font-weight: 600;
      color: var(--gc-on-surface);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--gc-blue-600);
    }

    h3 {
      font-size: 18px;
      font-weight: 600;
      color: var(--gc-on-surface);
      margin: 16px 0 8px 0;
    }

    .subtitle {
      font-size: 14px;
      color: var(--gc-outline);
      text-align: right;
      white-space: nowrap;
      margin-top: 4px;
    }

    .section {
      background: var(--gc-surface-container-low);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--gc-outline-variant);
    }

    .highlight {
      background-color: var(--gc-blue-50);
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
      color: var(--gc-blue-800);
      border-bottom: 2px solid var(--gc-blue-600);
    }

    .card {
      background: var(--gc-surface);
      border-radius: 12px;
      padding: 20px;
      margin: 12px 0;
      border-left: 4px solid var(--gc-blue-600);
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.12), 0 1px 2px rgba(60, 64, 67, 0.08);
    }

    .card-green {
      border-left-color: var(--gc-green);
    }

    .card-orange {
      border-left-color: var(--gc-orange);
    }

    .card-red {
      border-left-color: var(--gc-red);
    }

    .card-purple {
      border-left-color: var(--gc-purple);
    }

    .icon-text {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin: 8px 0;
      color: var(--gc-on-surface-variant);
    }

    .badge,
    .badge-ga,
    .badge-preview,
    .badge-deprecated {
      display: inline-block;
      color: #FFFFFF;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.25px;
      margin: 4px 8px 4px 0;
    }

    .badge { background: var(--gc-blue-600); }
    .badge-ga { background: var(--gc-green); color: #FFFFFF; }
    .badge-preview { background: var(--gc-orange); color: #FFFFFF; }
    .badge-deprecated { background: var(--gc-red); color: #FFFFFF; }

    /* Before/After comparison */
    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin: 16px 0;
    }

    .before-card {
      background: var(--gc-red-tint);
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid var(--gc-red);
    }

    .after-card {
      background: var(--gc-green-tint);
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid var(--gc-green);
    }

    .before-card h3, .after-card h3 {
      margin-top: 0;
      margin-bottom: 12px;
    }

    .before-card ul, .after-card ul {
      padding-left: 20px;
      margin: 0;
    }

    .before-card li, .after-card li {
      margin: 6px 0;
    }

    /* Stats grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 16px 0;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--gc-blue-600), var(--gc-blue-800));
      color: var(--gc-surface);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
    }

    .stat-card.green { background: linear-gradient(135deg, var(--gc-green), #1B8A3E); }
    .stat-card.orange { background: linear-gradient(135deg, var(--gc-orange), #E65100); }
    .stat-card.purple { background: linear-gradient(135deg, var(--gc-purple), #7B1FA2); }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    /* Feature cards grid */
    .feature-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin: 16px 0;
    }

    .feature-card {
      background: var(--gc-surface);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--gc-outline-variant);
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.12);
    }

    .feature-card h3 {
      color: var(--gc-blue-800);
      margin-top: 0;
      font-size: 16px;
    }

    .feature-card p {
      margin: 8px 0 0 0;
      font-size: 14px;
    }

    /* Usecase styling */
    .usecase-card {
      background: var(--gc-blue-tint);
      border-radius: 12px;
      padding: 20px;
      margin: 16px 0;
      border: 1px solid var(--gc-blue-200);
    }

    .usecase-card h3 {
      color: var(--gc-blue-900);
      margin-top: 0;
    }

    .usecase-card p {
      margin: 8px 0;
      font-size: 14px;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--gc-outline-variant);
    }

    th {
      background: var(--gc-blue-50);
      color: var(--gc-blue-900);
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      border-bottom: 2px solid var(--gc-blue-200);
    }

    td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--gc-outline-variant);
      font-size: 14px;
    }

    tr:nth-child(even) { background: var(--gc-surface-container-lowest); }
    tr:hover { background: var(--gc-blue-50); }

    /* Note/Warning boxes */
    .note-box {
      background: var(--gc-blue-tint);
      border-left: 4px solid var(--gc-blue-600);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }

    .warning-box {
      background: var(--gc-yellow-tint);
      border-left: 4px solid var(--gc-yellow);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }

    .error-box {
      background: var(--gc-red-tint);
      border-left: 4px solid var(--gc-red);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }

    .success-box {
      background: var(--gc-green-tint);
      border-left: 4px solid var(--gc-green);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }

    /* Code blocks */
    .code-block {
      background: #1E1E1E;
      border-radius: 8px;
      overflow: hidden;
      margin: 16px 0;
    }

    .code-header {
      background: #2D2D2D;
      padding: 8px 16px;
      display: flex;
      justify-content: space-between;
      font-size: 12px;
    }

    .code-lang {
      color: #9CDCFE;
      font-weight: bold;
    }

    .code-title {
      color: #AAAAAA;
    }

    .code-block pre {
      margin: 0;
      padding: 0;
      overflow-x: auto;
      background: #1E1E1E;
    }

    .code-block code {
      font-family: 'Roboto Mono', 'Source Code Pro', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      padding: 16px !important;
    }

    pre:not(.mermaid) {
      background: #1E1E1E;
      border-radius: 8px;
      padding: 16px;
      font-family: 'Roboto Mono', 'Source Code Pro', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      overflow-x: auto;
      color: #E8E8E8;
      margin: 16px 0;
    }

    pre code {
      background: none;
      border: none;
      padding: 0;
      font-size: inherit;
      color: inherit;
    }

    code:not(pre code) {
      background: var(--gc-surface-container-low);
      border: 1px solid var(--gc-outline-variant);
      border-radius: 4px;
      padding: 2px 6px;
      font-family: 'Roboto Mono', 'Source Code Pro', 'Courier New', monospace;
      font-size: 0.9em;
      color: var(--gc-blue-900);
    }

    /* Mermaid */
    .mermaid-container {
      background: #FFFFFF;
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
      border: 2px solid rgba(66, 133, 244, 0.3);
      overflow-x: auto;
    }

    .mermaid {
      display: flex;
      justify-content: center;
    }

    /* Flow diagram */
    .flow-diagram {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      margin: 24px 0;
    }

    .flow-step {
      background: var(--gc-surface);
      border: 2px solid var(--gc-blue-600);
      border-radius: 12px;
      padding: 12px 20px;
      text-align: center;
      min-width: 100px;
      color: var(--gc-on-surface);
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.12);
    }

    .flow-arrow {
      color: var(--gc-blue-600);
      font-size: 24px;
      font-weight: bold;
    }

    /* Link styling */
    .gc-link {
      color: var(--gc-blue-600);
      text-decoration: none;
    }

    .gc-link:hover {
      color: var(--gc-blue-800);
      text-decoration: underline;
    }

    /* Footer */
    footer {
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--gc-outline-variant);
      font-size: 12px;
      color: var(--gc-outline);
    }

    footer a {
      color: var(--gc-blue-600);
      text-decoration: none;
      word-break: break-all;
    }

    footer a:hover {
      text-decoration: underline;
    }

    footer ul {
      list-style: none;
      padding: 0;
      margin: 8px 0;
    }

    footer li {
      margin: 4px 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
      h1 { font-size: 24px; }
      .header { flex-direction: column; }
      .subtitle { text-align: left; margin-top: 8px; }
      .comparison-grid { grid-template-columns: 1fr; }
      .feature-grid { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
</head>
<body>
  <div class="container">

    <!-- Header -->
    <div class="header">
      <div>
        <h1>&#9729;&#65039; Cloud Composer: 新ビルドリリースと Airflow 3 環境スナップショット対応</h1>
        <div style="margin-top: 8px;">
          <span class="badge">Cloud Composer</span>
          <span class="badge-ga">GA (ビルド)</span>
          <span class="badge-preview">Preview (Airflow 3 スナップショット)</span>
        </div>
      </div>
      <div class="subtitle">2026-02-16</div>
    </div>

    <!-- Overview -->
    <div class="section">
      <h2>&#128196; 概要</h2>
      <p>2026 年 2 月 16 日、Cloud Composer に複数の重要なアップデートが提供された。Cloud Composer 3 では <span class="highlight">Airflow 3.1.0 の新ビルド (build.9)</span> を含む 3 つの新ビルドが利用可能になり、Cloud Composer 2 でも 2 つの新イメージがリリースされた。</p>
      <p style="margin-top: 12px;">特に注目すべきは、<span class="highlight">Airflow 3 (Preview) 環境での環境スナップショット機能</span>が Cloud Composer 3 がサポートする全リージョンに展開された点である。Airflow 3 は Apache Airflow プロジェクトにおけるメジャーバージョンアップグレードであり、Cloud Composer 3 上での Airflow 3.1.0 サポートにより、ワークフローオーケストレーションの次世代機能を Google Cloud のマネージド環境で利用できるようになった。</p>
      <p style="margin-top: 12px;">また、<code>composer-3-airflow-2.9.3-build.15</code> および <code>composer-2.11.2-*</code> がサポート終了 (End of Support) に達しており、これらのバージョンを使用しているユーザーは新しいバージョンへのアップグレードが推奨される。</p>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value">3</div>
        <div class="stat-label">Composer 3 新ビルド</div>
      </div>
      <div class="stat-card green">
        <div class="stat-value">2</div>
        <div class="stat-label">Composer 2 新イメージ</div>
      </div>
      <div class="stat-card orange">
        <div class="stat-value">全リージョン</div>
        <div class="stat-label">Airflow 3 スナップショット展開</div>
      </div>
      <div class="stat-card purple">
        <div class="stat-value">12 ヶ月</div>
        <div class="stat-label">バージョンサポート期間</div>
      </div>
    </div>

    <!-- Before/After -->
    <div class="section">
      <h2>&#128260; Before / After</h2>
      <div class="comparison-grid">
        <div class="before-card">
          <h3>&#10060; アップデート前の課題</h3>
          <ul>
            <li>Airflow 3 (Preview) 環境では環境スナップショットの保存・復元ができなかった (一部リージョンのみ対応)</li>
            <li>Cloud Composer 3 で利用可能な Airflow 3.1.0 のビルドが build.8 までに限られていた</li>
            <li>サポート終了が近いバージョンの利用者はセキュリティ修正やバグ修正を受けられなくなるリスクがあった</li>
          </ul>
        </div>
        <div class="after-card">
          <h3>&#9989; アップデート後の改善</h3>
          <ul>
            <li>Airflow 3 環境での環境スナップショットが Cloud Composer 3 の全対応リージョンで利用可能になった (Preview)</li>
            <li>最新のセキュリティ修正とバグ修正を含む新しい Airflow ビルドが利用可能になった</li>
            <li>Cloud Composer 3 ではデフォルトビルドが <code>composer-3-airflow-2.10.5-build.26</code> に更新され、最新の安定ビルドが自動的に適用される</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Architecture Diagram (Mermaid) -->
    <div class="section">
      <h2>&#128736;&#65039; アーキテクチャ図</h2>
      <p>Cloud Composer 3 と Cloud Composer 2 のバージョン構成、環境スナップショットのワークフロー、およびサポート終了バージョンからのアップグレードパスを示す図。</p>
      <div class="mermaid-container">
        <pre class="mermaid">
flowchart TD
    subgraph CC3["Cloud Composer 3"]
        AF31["Airflow 3.1.0\nbuild.9"]
        AF2105["Airflow 2.10.5\nbuild.26\n(default)"]
        AF293["Airflow 2.9.3\nbuild.46"]
    end

    subgraph CC2["Cloud Composer 2"]
        IMG2105["composer-2.16.4\nairflow-2.10.5\n(default)"]
        IMG293["composer-2.16.4\nairflow-2.9.3"]
    end

    subgraph Snapshot["環境スナップショット"]
        Save["スナップショット保存"]
        Load["スナップショット復元"]
        GCS[("Cloud Storage\nsnapshots/")]
    end

    AF31 -->|"Preview"| Save
    AF2105 --> Save
    AF293 --> Save
    Save --> GCS
    GCS --> Load
    Load -->|"同一/上位バージョンへ"| CC3

    subgraph Deprecated["サポート終了"]
        DEP1["composer-3-airflow-\n2.9.3-build.15"]
        DEP2["composer-2.11.2-*"]
    end

    DEP1 -.->|"アップグレード推奨"| AF293
    DEP2 -.->|"アップグレード推奨"| CC2
        </pre>
      </div>
    </div>

    <!-- Key Features -->
    <div class="section">
      <h2>&#9889; 主要機能</h2>
      <div class="feature-grid">
        <div class="feature-card">
          <h3>&#128230; Cloud Composer 3 の新 Airflow ビルド</h3>
          <p><code>composer-3-airflow-3.1.0-build.9</code>: Airflow 3.1.0 の最新ビルド</p>
          <p><code>composer-3-airflow-2.10.5-build.26</code>: Airflow 2.10.5 の最新ビルド (デフォルト)</p>
          <p><code>composer-3-airflow-2.9.3-build.46</code>: Airflow 2.9.3 の最新ビルド</p>
          <p style="margin-top: 8px; font-size: 13px; color: var(--gc-outline);">各ビルドは Python 3.11.8 を使用</p>
        </div>
        <div class="feature-card">
          <h3>&#128247; Cloud Composer 2 の新イメージ</h3>
          <p><code>composer-2.16.4-airflow-2.10.5</code>: デフォルトイメージ</p>
          <p><code>composer-2.16.4-airflow-2.9.3</code>: Airflow 2.9.3 イメージ</p>
        </div>
        <div class="feature-card">
          <h3>&#128248; Airflow 3 環境スナップショット <span class="badge-preview">Preview</span></h3>
          <p>Airflow 3 (Preview) を使用する環境で環境スナップショットの保存・復元が可能に</p>
          <p>Cloud Composer 3 がサポートする全リージョンに展開完了</p>
          <p>環境のバックアップ、復元、サイドバイサイド移行に活用可能</p>
        </div>
        <div class="feature-card">
          <h3>&#9888;&#65039; バージョン非推奨化・サポート終了</h3>
          <p><code>composer-3-airflow-2.9.3-build.15</code> がサポート終了</p>
          <p><code>composer-2.11.2-*</code> の全イメージがサポート終了</p>
          <p style="color: var(--gc-red); font-weight: 500; margin-top: 8px;">サポート終了後も環境は動作するが、セキュリティ修正は提供されない</p>
        </div>
      </div>
    </div>

    <!-- Technical Specifications -->
    <div class="section">
      <h2>&#128202; 技術仕様</h2>

      <h3>Cloud Composer 3 バージョン一覧 (2026-02-16 リリース)</h3>
      <table>
        <thead>
          <tr>
            <th>ビルド名</th>
            <th>Airflow バージョン</th>
            <th>Python</th>
            <th>備考</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>composer-3-airflow-3.1.0-build.9</code></td>
            <td>3.1.0</td>
            <td>3.11.8</td>
            <td>最新ビルド</td>
          </tr>
          <tr>
            <td><code>composer-3-airflow-2.10.5-build.26</code></td>
            <td>2.10.5</td>
            <td>3.11.8</td>
            <td>最新ビルド、デフォルト</td>
          </tr>
          <tr>
            <td><code>composer-3-airflow-2.9.3-build.46</code></td>
            <td>2.9.3</td>
            <td>3.11.8</td>
            <td>最新ビルド</td>
          </tr>
        </tbody>
      </table>

      <h3>Cloud Composer 2 イメージ一覧 (2026-02-16 リリース)</h3>
      <table>
        <thead>
          <tr>
            <th>イメージ名</th>
            <th>Airflow バージョン</th>
            <th>備考</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>composer-2.16.4-airflow-2.10.5</code></td>
            <td>2.10.5</td>
            <td>デフォルト</td>
          </tr>
          <tr>
            <td><code>composer-2.16.4-airflow-2.9.3</code></td>
            <td>2.9.3</td>
            <td>-</td>
          </tr>
        </tbody>
      </table>

      <h3>環境スナップショットの仕様</h3>
      <table>
        <thead>
          <tr>
            <th>項目</th>
            <th>詳細</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>対応バージョン</td>
            <td>Cloud Composer 3 (Airflow 3 Preview 含む)、Cloud Composer 2 (2.0.9 以降)</td>
          </tr>
          <tr>
            <td>保存データ</td>
            <td>Airflow 構成オーバーライド、環境変数、PyPI パッケージリスト、Airflow DB バックアップ、DAGs/data/plugins フォルダ、Fernet キー</td>
          </tr>
          <tr>
            <td>保存先 (デフォルト)</td>
            <td>環境バケット内の <code>snapshots/</code> フォルダ</td>
          </tr>
          <tr>
            <td>DB サイズ上限</td>
            <td>20 GB</td>
          </tr>
          <tr>
            <td>オブジェクト数上限</td>
            <td>/dags、/plugins、/data フォルダ合計で 100,000 未満</td>
          </tr>
          <tr>
            <td>オブジェクト名長制限</td>
            <td>1,024 文字以内</td>
          </tr>
          <tr>
            <td>復元制約</td>
            <td>同一または上位バージョンの Airflow にのみ復元可能</td>
          </tr>
        </tbody>
      </table>

      <h3>バージョンサポートポリシー</h3>
      <table>
        <thead>
          <tr>
            <th>Cloud Composer バージョン</th>
            <th>サポート期間</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Cloud Composer 3 ビルド</td>
            <td>リリース日から 12 ヶ月間</td>
          </tr>
          <tr>
            <td>Cloud Composer 2 イメージ</td>
            <td>リリース日から 12 ヶ月間</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Setup Guide -->
    <div class="section">
      <h2>&#128295; 設定方法</h2>

      <h3>前提条件</h3>
      <div class="note-box">
        <strong>&#128161; 前提条件:</strong>
        <ul style="padding-left: 20px; margin-top: 8px;">
          <li>Cloud Composer API が有効化されたプロジェクト</li>
          <li>Airflow 3 環境を使用する場合は Cloud Composer 3 環境が必要</li>
          <li>スナップショットをカスタムバケットに保存する場合、環境のサービスアカウントに Storage Object Admin ロールが必要</li>
        </ul>
      </div>

      <h3>ステップ 1: 新しいビルドで環境を作成</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">Airflow 3.1.0 の最新ビルドで環境を作成</span>
        </div>
        <pre><code class="language-bash"># Airflow 3.1.0 の最新ビルドで Cloud Composer 3 環境を作成
gcloud composer environments create my-environment \
  --location us-central1 \
  --image-version composer-3-airflow-3.1.0-build.9</code></pre>
      </div>

      <h3>ステップ 2: 既存環境をアップグレード</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">既存環境を最新ビルドにアップグレード</span>
        </div>
        <pre><code class="language-bash"># 既存の Cloud Composer 3 環境を最新ビルドにアップグレード
gcloud composer environments update my-environment \
  --location us-central1 \
  --airflow-version 2.10.5-build.26</code></pre>
      </div>

      <h3>ステップ 3: 環境スナップショットの保存</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">スナップショットの保存</span>
        </div>
        <pre><code class="language-bash"># 環境のスナップショットを保存
gcloud composer environments snapshots save my-environment \
  --location us-central1

# カスタムロケーションに保存する場合
gcloud composer environments snapshots save my-environment \
  --location us-central1 \
  --snapshot-location gs://my-bucket/snapshots/</code></pre>
      </div>

      <h3>ステップ 4: 環境スナップショットの復元</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">スナップショットの復元</span>
        </div>
        <pre><code class="language-bash"># スナップショットを環境に復元
gcloud composer environments snapshots load my-environment \
  --location us-central1 \
  --snapshot-path "gs://us-central1-my-env-bucket/snapshots/2026-02-16T12-00-00"</code></pre>
      </div>
    </div>

    <!-- Snapshot workflow flow diagram -->
    <div class="section">
      <h2>&#128260; スナップショットのワークフロー</h2>
      <div class="flow-diagram">
        <div class="flow-step">&#128230; Composer 環境</div>
        <span class="flow-arrow">&rarr;</span>
        <div class="flow-step">&#128190; スナップショット保存</div>
        <span class="flow-arrow">&rarr;</span>
        <div class="flow-step">&#9729;&#65039; Cloud Storage</div>
        <span class="flow-arrow">&rarr;</span>
        <div class="flow-step">&#128259; スナップショット復元</div>
        <span class="flow-arrow">&rarr;</span>
        <div class="flow-step">&#9989; 新環境</div>
      </div>
    </div>

    <!-- Benefits -->
    <div class="section">
      <h2>&#9989; メリット</h2>

      <h3>&#128188; ビジネス面</h3>
      <div class="card card-green">
        <div class="icon-text">
          <span>&#128737;&#65039;</span>
          <span><strong>事業継続性の向上:</strong> Airflow 3 環境でもスナップショットによるバックアップ・リストアが可能になり、ワークフロー管理のリスクが低減される</span>
        </div>
      </div>
      <div class="card card-green">
        <div class="icon-text">
          <span>&#128256;</span>
          <span><strong>移行の柔軟性:</strong> スナップショットを活用した Airflow 2 から Airflow 3 へのサイドバイサイド移行が可能になり、ダウンタイムを最小限に抑えた移行計画を立てられる</span>
        </div>
      </div>
      <div class="card card-green">
        <div class="icon-text">
          <span>&#128640;</span>
          <span><strong>最新機能の迅速な導入:</strong> 定期的なビルドリリースにより、セキュリティ修正やバグ修正が迅速に提供される</span>
        </div>
      </div>

      <h3 style="margin-top: 24px;">&#128736;&#65039; 技術面</h3>
      <div class="card">
        <div class="icon-text">
          <span>&#9889;</span>
          <span><strong>Airflow 3 の新機能:</strong> メジャーバージョンアップグレードであり、改善されたスケジューラ、新しい UI、より良いタスク管理などの恩恵を受けられる</span>
        </div>
      </div>
      <div class="card">
        <div class="icon-text">
          <span>&#128736;&#65039;</span>
          <span><strong>CeleryKubernetes Executor:</strong> Cloud Composer 3 では CeleryKubernetes Executor が使用可能で、Airflow 3 との組み合わせでより効率的なタスク実行が可能</span>
        </div>
      </div>
      <div class="card">
        <div class="icon-text">
          <span>&#128200;</span>
          <span><strong>自動スケーリング:</strong> Cloud Composer 3 のワーカーは自動スケーリングに対応しており、需要に応じたリソース最適化が行われる</span>
        </div>
      </div>
    </div>

    <!-- Limitations -->
    <div class="section">
      <h2>&#9888;&#65039; デメリット・制約事項</h2>

      <h3>制限事項</h3>
      <div class="warning-box">
        <ul style="padding-left: 20px; margin: 0;">
          <li>Airflow 3 サポートは <strong>Preview ステータス</strong>であり、本番環境での利用は推奨されない場合がある</li>
          <li>スナップショットは同一または上位バージョンの Airflow にのみ復元可能 (例: Airflow 3.1.0 のスナップショットを Airflow 2.10.5 に復元することはできない)</li>
          <li>Airflow データベースのサイズが <strong>20 GB を超える場合</strong>、スナップショットを作成できない</li>
          <li>/dags、/plugins、/data フォルダ内のオブジェクト合計数が <strong>100,000 以上</strong>の場合、スナップショットを作成できない</li>
        </ul>
      </div>

      <h3>考慮すべき点</h3>
      <div class="error-box">
        <ul style="padding-left: 20px; margin: 0;">
          <li>スナップショットには <strong>Fernet キー</strong>が含まれるため、Airflow 接続のパスワードなどの機密情報が復号可能になる。<strong>Secret Manager の使用が推奨される</strong></li>
          <li>サポート終了バージョン (<code>composer-3-airflow-2.9.3-build.15</code>、<code>composer-2.11.2-*</code>) を使用中の環境は、セキュリティ脆弱性への対応が提供されないため、<strong>早急なアップグレードが必要</strong></li>
          <li>Airflow 2 から Airflow 3 への移行には DAG の互換性確認が必要 (Airflow 3 での破壊的変更の確認)</li>
        </ul>
      </div>
    </div>

    <!-- Use Cases -->
    <div class="section">
      <h2>&#128161; ユースケース</h2>

      <div class="usecase-card">
        <h3>&#128221; ユースケース 1: Airflow 3 への段階的移行</h3>
        <p><strong>シナリオ:</strong> 大規模な Airflow 2 環境を運用しており、Airflow 3 の新機能を検証しつつ段階的に移行したい</p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Bash</span>
            <span class="code-title">段階的移行の実装例</span>
          </div>
          <pre><code class="language-bash"># 1. 現在の Airflow 2 環境のスナップショットを保存
gcloud composer environments snapshots save prod-env \
  --location us-central1

# 2. Airflow 3 の新しい環境を作成
gcloud composer environments create staging-airflow3 \
  --location us-central1 \
  --image-version composer-3-airflow-3.1.0-build.9

# 3. DAG の互換性を確認後、必要な DAG を移行
# (Airflow 2 のスナップショットを Airflow 3 に直接復元する場合は
#  DAG の互換性を事前に確認すること)</code></pre>
        </div>
        <div class="success-box">
          <strong>&#127919; 効果:</strong> 本番環境に影響を与えずに Airflow 3 の検証が可能。問題が発生した場合もスナップショットから Airflow 2 環境を即座に復元できる
        </div>
      </div>

      <div class="usecase-card">
        <h3>&#128737;&#65039; ユースケース 2: 災害復旧 (DR) とバックアップ戦略</h3>
        <p><strong>シナリオ:</strong> Airflow 3 環境のワークフローを定期的にバックアップし、障害発生時に迅速に復旧したい</p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">Bash</span>
            <span class="code-title">スケジュールされたスナップショットの設定</span>
          </div>
          <pre><code class="language-bash"># スケジュールされたスナップショットの設定
# (Cloud Composer 3 ではスケジュールスナップショットの設定も可能)
gcloud composer environments update my-airflow3-env \
  --location us-central1 \
  --cloud-sql-preferred-maintenance-window-day SUNDAY \
  --cloud-sql-preferred-maintenance-window-hour 2</code></pre>
        </div>
        <div class="success-box">
          <strong>&#127919; 効果:</strong> 定期的なバックアップにより、環境の設定変更やパッケージ更新の失敗時に迅速なロールバックが可能
        </div>
      </div>
    </div>

    <!-- Pricing -->
    <div class="section">
      <h2>&#128176; 料金</h2>
      <p>Cloud Composer の料金はバージョンごとに異なる料金モデルが適用される。スナップショットの作成・保存に関連する追加コストは Cloud Storage の料金に準じる。</p>

      <h3>スナップショット関連コスト</h3>
      <table>
        <thead>
          <tr>
            <th>項目</th>
            <th>料金体系</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>スナップショット保存</td>
            <td>Cloud Storage の標準料金 (保存容量分)</td>
          </tr>
          <tr>
            <td>スナップショット操作 (API)</td>
            <td>Cloud Composer API クォータ内で無料</td>
          </tr>
        </tbody>
      </table>

      <h3>API クォータ</h3>
      <table>
        <thead>
          <tr>
            <th>操作</th>
            <th>クォータ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Save snapshot (プロジェクトあたり)</td>
            <td>5,000 クォータユニット/日、250 クォータユニット/分</td>
          </tr>
          <tr>
            <td>Save snapshot (環境あたり)</td>
            <td>2,600 クォータユニット/日</td>
          </tr>
          <tr>
            <td>Load snapshot (プロジェクトあたり)</td>
            <td>2,500 クォータユニット/日、150 クォータユニット/分</td>
          </tr>
          <tr>
            <td>Load snapshot (環境あたり)</td>
            <td>700 クォータユニット/日</td>
          </tr>
        </tbody>
      </table>

      <p style="margin-top: 12px;">詳細は <a href="https://cloud.google.com/composer/pricing" target="_blank" class="gc-link">Cloud Composer 料金ページ</a> を参照。</p>
    </div>

    <!-- Regions -->
    <div class="section">
      <h2>&#127758; 利用可能リージョン</h2>
      <p>Airflow 3 環境スナップショットは、<span class="highlight">Cloud Composer 3 がサポートする全リージョン</span>で利用可能 (2026 年 2 月 16 日時点)。</p>
      <p style="margin-top: 8px;">Cloud Composer 3 の新ビルドは、2026 年 2 月 16 日から開始された新リリースとして全リージョンに段階的にロールアウトされる。</p>
    </div>

    <!-- Related Services -->
    <div class="section">
      <h2>&#128279; 関連サービス・機能</h2>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <div class="card">
          <div class="icon-text">
            <span>&#9729;&#65039;</span>
            <span><strong>Cloud Storage:</strong> 環境スナップショットの保存先として使用。デフォルトでは環境バケット内の <code>snapshots/</code> フォルダに保存</span>
          </div>
        </div>
        <div class="card">
          <div class="icon-text">
            <span>&#128272;</span>
            <span><strong>Secret Manager:</strong> スナップショットには Fernet キーが含まれるため、機密情報の管理に推奨</span>
          </div>
        </div>
        <div class="card">
          <div class="icon-text">
            <span>&#128202;</span>
            <span><strong>Cloud Monitoring:</strong> Cloud Composer 環境の健全性やパフォーマンスの監視に使用</span>
          </div>
        </div>
        <div class="card">
          <div class="icon-text">
            <span>&#128196;</span>
            <span><strong>Cloud Logging:</strong> Airflow のタスクログ、スケジューラログの管理に使用</span>
          </div>
        </div>
        <div class="card" style="grid-column: span 2;">
          <div class="icon-text">
            <span>&#128296;</span>
            <span><strong>Apache Airflow 3:</strong> Cloud Composer 3 で Preview サポートされるオープンソースのワークフローオーケストレーションプラットフォーム</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Summary -->
    <div class="section" style="background: var(--gc-blue-tint); border-color: var(--gc-blue-600);">
      <h2>&#128221; まとめ</h2>
      <p>今回のアップデートは、Cloud Composer における <span class="highlight">Airflow 3 エコシステムの成熟</span>を示す重要なリリースである。Airflow 3 環境でのスナップショット機能が全リージョンに展開されたことで、Airflow 3 の Preview 評価がより安全かつ実践的に行えるようになった。</p>
      <p style="margin-top: 12px;">Airflow 2 を使用中のユーザーは、<strong>サポート終了バージョンからのアップグレードを優先</strong>しつつ、<strong>Airflow 3 への移行計画を検討</strong>することが推奨される。</p>
    </div>

    <!-- Footer -->
    <footer>
      <p><strong>&#128206; 出典:</strong></p>
      <ul>
        <li><a href="https://cloud.google.com/release-notes#February_16_2026" target="_blank" rel="noopener noreferrer">公式リリースノート</a></li>
        <li><a href="https://cloud.google.com/composer/docs/composer-versions" target="_blank" rel="noopener noreferrer">Cloud Composer バージョン一覧</a></li>
        <li><a href="https://cloud.google.com/composer/docs/composer-3/save-load-snapshots" target="_blank" rel="noopener noreferrer">環境スナップショットの保存と復元 (Composer 3)</a></li>
        <li><a href="https://cloud.google.com/composer/docs/composer-versioning-overview" target="_blank" rel="noopener noreferrer">Cloud Composer バージョニング概要</a></li>
        <li><a href="https://cloud.google.com/composer/docs/composer-2/migrate-composer-3" target="_blank" rel="noopener noreferrer">Cloud Composer 2 から 3 への移行ガイド (スナップショット)</a></li>
        <li><a href="https://cloud.google.com/composer/pricing" target="_blank" rel="noopener noreferrer">Cloud Composer 料金</a></li>
      </ul>
      <p style="margin-top: 12px; font-size: 11px; color: var(--gc-outline);">#CloudComposer #Airflow3 #EnvironmentSnapshots #GCP #WorkflowOrchestration #Preview #VersionUpdate</p>
    </footer>

  </div>

  <!-- Mermaid.js -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'base',
      themeVariables: {
        primaryColor: '#4285F4',
        primaryTextColor: '#202124',
        primaryBorderColor: '#4285F4',
        lineColor: '#4285F4',
        secondaryColor: '#F1F3F4',
        tertiaryColor: '#FAFAFA',
        background: '#FFFFFF',
        mainBkg: '#E8F0FE',
        nodeBorder: '#4285F4',
        clusterBkg: '#E8F0FE',
        clusterBorder: '#4285F4',
        edgeLabelBackground: '#FFFFFF',
        textColor: '#202124'
      }
    });
  </script>

  <!-- highlight.js -->
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</body>
</html>
