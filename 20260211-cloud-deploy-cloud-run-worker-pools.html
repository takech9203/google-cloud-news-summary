<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cloud Deploy: Cloud Run ワーカープール GA</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap');

    /* Google Cloud Light Theme Base Styles */
    :root {
      --gc-blue: #4285F4;
      --gc-red: #EA4335;
      --gc-yellow: #FBBC04;
      --gc-green: #34A853;
      --gc-blue-900: #174EA6;
      --gc-blue-800: #185ABC;
      --gc-blue-700: #1967D2;
      --gc-blue-600: #1A73E8;
      --gc-blue-500: #4285F4;
      --gc-blue-300: #669DF6;
      --gc-blue-200: #8AB4F8;
      --gc-blue-100: #AECBFA;
      --gc-blue-50: #E8F0FE;
      --gc-on-surface: #202124;
      --gc-on-surface-variant: #5F6368;
      --gc-outline: #80868B;
      --gc-surface: #FFFFFF;
      --gc-surface-container-lowest: #F8F9FA;
      --gc-surface-container-low: #F1F3F4;
      --gc-surface-container: #E8EAED;
      --gc-outline-variant: #DADCE0;
      --gc-blue-tint: #E8F0FE;
      --gc-green-tint: #E6F4EA;
      --gc-red-tint: #FCE8E6;
      --gc-yellow-tint: #FEF7E0;
      --gc-purple-tint: #F3E8FD;
      --gc-teal-tint: #E0F7FA;
      --gc-purple: #A142F4;
      --gc-teal: #00BCD4;
      --gc-orange: #FF6D00;
    }

    body {
      background-color: var(--gc-surface);
      font-family: 'Google Sans', 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      color: var(--gc-on-surface-variant);
      font-size: 16px;
      line-height: 1.7;
      padding: 20px;
      margin: 0;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      width: 100%;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 32px;
      flex-wrap: wrap;
      padding-bottom: 16px;
      border-bottom: 3px solid var(--gc-blue-600);
    }

    .header-left { flex: 1; }

    h1, .title {
      font-size: 36px;
      font-weight: 700;
      color: var(--gc-on-surface);
      margin: 0 0 8px 0;
    }

    h2, .section-title {
      font-size: 24px;
      font-weight: 600;
      color: var(--gc-on-surface);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--gc-blue-600);
    }

    h3 {
      font-size: 20px;
      font-weight: 600;
      color: var(--gc-on-surface);
      margin: 20px 0 12px 0;
    }

    .subtitle {
      font-size: 16px;
      color: var(--gc-outline);
    }

    .section {
      background: var(--gc-surface-container-low);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--gc-outline-variant);
    }

    .highlight {
      background-color: var(--gc-blue-50);
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
      color: var(--gc-blue-800);
      border-bottom: 2px solid var(--gc-blue-600);
    }

    .card {
      background: var(--gc-surface);
      border-radius: 12px;
      padding: 20px;
      margin: 12px 0;
      border-left: 4px solid var(--gc-blue-600);
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.12), 0 1px 2px rgba(60, 64, 67, 0.08);
    }

    .card-green { border-left-color: var(--gc-green); }
    .card-orange { border-left-color: var(--gc-orange); }
    .card-purple { border-left-color: var(--gc-purple); }
    .card-red { border-left-color: var(--gc-red); }
    .card-teal { border-left-color: var(--gc-teal); }

    .icon-text {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 8px 0;
      color: var(--gc-on-surface-variant);
    }

    .arrow {
      color: var(--gc-blue-600);
      font-size: 20px;
    }

    .gc-link {
      color: var(--gc-blue-600);
      text-decoration: none;
    }

    .gc-link:hover {
      color: var(--gc-blue-800);
      text-decoration: underline;
    }

    .badge,
    .badge-ga,
    .badge-preview,
    .badge-deprecated {
      display: inline-block;
      color: #FFFFFF;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.25px;
      margin: 4px 8px 4px 0;
    }

    .badge { background: var(--gc-blue-600); }
    .badge-ga { background: var(--gc-green); color: #FFFFFF; }
    .badge-preview { background: var(--gc-orange); color: #FFFFFF; }

    .flow-diagram {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      margin: 24px 0;
    }

    .flow-step {
      background: var(--gc-surface);
      border: 2px solid var(--gc-blue-600);
      border-radius: 12px;
      padding: 12px 20px;
      text-align: center;
      min-width: 100px;
      color: var(--gc-on-surface);
      box-shadow: 0 1px 3px rgba(60, 64, 67, 0.12);
    }

    .flow-arrow {
      color: var(--gc-blue-600);
      font-size: 24px;
      font-weight: bold;
    }

    .check-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin: 8px 0;
    }

    .check-icon { color: var(--gc-green); font-size: 18px; }
    .cross-icon { color: var(--gc-red); font-size: 18px; }

    /* Code blocks */
    .code-block {
      background: #1E1E1E;
      border-radius: 8px;
      overflow: hidden;
      margin: 16px 0;
    }

    .code-header {
      background: #2D2D2D;
      padding: 8px 16px;
      display: flex;
      justify-content: space-between;
      font-size: 12px;
    }

    .code-lang {
      color: #9CDCFE;
      font-weight: bold;
    }

    .code-title {
      color: #AAAAAA;
    }

    .code-block pre {
      margin: 0;
      padding: 0;
      overflow-x: auto;
      background: #1E1E1E;
    }

    .code-block code {
      font-family: 'Roboto Mono', 'Source Code Pro', 'Courier New', monospace;
      font-size: 15px;
      line-height: 1.6;
      padding: 16px !important;
    }

    pre:not(.mermaid) {
      background: #1E1E1E;
      border-radius: 8px;
      padding: 16px;
      font-family: 'Roboto Mono', 'Source Code Pro', 'Courier New', monospace;
      font-size: 15px;
      line-height: 1.6;
      overflow-x: auto;
      color: #E8E8E8;
      margin: 16px 0;
    }

    pre code {
      background: none;
      border: none;
      padding: 0;
      font-size: inherit;
      color: inherit;
    }

    code:not(pre code) {
      background: var(--gc-surface-container-low);
      border: 1px solid var(--gc-outline-variant);
      border-radius: 4px;
      padding: 2px 6px;
      font-family: 'Roboto Mono', 'Source Code Pro', 'Courier New', monospace;
      font-size: 0.9em;
      color: var(--gc-blue-900);
    }

    /* Table styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--gc-outline-variant);
    }

    th {
      background: var(--gc-blue-50);
      color: var(--gc-blue-900);
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      border-bottom: 2px solid var(--gc-blue-200);
    }

    td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--gc-outline-variant);
      font-size: 14px;
    }

    tr:nth-child(even) { background: var(--gc-surface-container-lowest); }
    tr:hover { background: var(--gc-blue-50); }

    /* Note/Warning boxes */
    .note-box {
      background: var(--gc-blue-tint);
      border-left: 4px solid var(--gc-blue-600);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }

    .warning-box {
      background: var(--gc-yellow-tint);
      border-left: 4px solid var(--gc-yellow);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }

    .error-box {
      background: var(--gc-red-tint);
      border-left: 4px solid var(--gc-red);
      padding: 16px 20px;
      border-radius: 0 12px 12px 0;
      margin: 16px 0;
    }

    /* Stat cards */
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--gc-blue-600), var(--gc-blue-800));
      color: var(--gc-surface);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
    }

    .stat-card.green { background: linear-gradient(135deg, var(--gc-green), #1B5E20); }
    .stat-card.orange { background: linear-gradient(135deg, var(--gc-orange), #E65100); }
    .stat-card.purple { background: linear-gradient(135deg, var(--gc-purple), #6A1B9A); }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    /* Before/After */
    .before-after {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin: 20px 0;
    }

    .before-card {
      background: var(--gc-red-tint);
      border: 2px solid var(--gc-red);
      border-radius: 12px;
      padding: 20px;
    }

    .after-card {
      background: var(--gc-green-tint);
      border: 2px solid var(--gc-green);
      border-radius: 12px;
      padding: 20px;
    }

    .before-card h3, .after-card h3 {
      margin-top: 0;
      font-size: 18px;
    }

    .before-card ul, .after-card ul {
      margin: 0;
      padding-left: 20px;
    }

    .before-card li, .after-card li {
      margin: 6px 0;
      font-size: 14px;
    }

    /* Feature cards grid */
    .feature-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin: 16px 0;
    }

    /* Usecase cards */
    .usecase-card {
      background: var(--gc-blue-tint);
      border-radius: 12px;
      padding: 20px;
      margin: 12px 0;
      border: 1px solid var(--gc-blue-200);
    }

    .usecase-card h4 {
      color: var(--gc-blue-900);
      margin: 0 0 8px 0;
      font-size: 18px;
    }

    .usecase-card p {
      margin: 4px 0;
      font-size: 14px;
    }

    /* Mermaid */
    .mermaid-container {
      background: #FFFFFF;
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
      border: 2px solid rgba(66, 133, 244, 0.3);
      overflow-x: auto;
    }

    .mermaid {
      display: flex;
      justify-content: center;
    }

    /* Region chips */
    .region-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 12px 0;
    }

    .region-chip {
      background: var(--gc-blue-50);
      border: 1px solid var(--gc-blue-200);
      border-radius: 20px;
      padding: 6px 14px;
      font-size: 13px;
      color: var(--gc-blue-900);
    }

    .region-chip.tier2 {
      background: var(--gc-surface-container-low);
      border-color: var(--gc-outline-variant);
      color: var(--gc-on-surface-variant);
    }

    /* Links list */
    .links-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .links-list li {
      margin: 8px 0;
      padding: 8px 12px;
      background: var(--gc-surface);
      border-radius: 8px;
      border: 1px solid var(--gc-outline-variant);
      font-size: 14px;
      word-break: break-all;
    }

    .links-list li a {
      color: var(--gc-blue-600);
      text-decoration: none;
    }

    .links-list li a:hover {
      text-decoration: underline;
    }

    /* Related services */
    .related-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin: 16px 0;
    }

    .related-item {
      background: var(--gc-surface);
      border: 1px solid var(--gc-outline-variant);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      font-size: 14px;
    }

    .related-item strong {
      display: block;
      color: var(--gc-on-surface);
      margin-bottom: 4px;
    }

    .related-item span {
      font-size: 12px;
      color: var(--gc-outline);
    }

    footer {
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid var(--gc-outline-variant);
      font-size: 12px;
      color: var(--gc-outline);
    }

    footer a {
      color: var(--gc-blue-600);
      text-decoration: underline;
      word-break: break-all;
    }

    /* Responsive */
    @media (max-width: 768px) {
      h1 { font-size: 28px; }
      .before-after { grid-template-columns: 1fr; }
      .stat-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <h1>&#9881;&#65039; Cloud Deploy: Cloud Run ワーカープール GA</h1>
        <div style="margin-top: 8px;">
          <span class="badge">Cloud Deploy</span>
          <span class="badge-ga" style="display:inline-block;color:#FFFFFF;padding:4px 12px;border-radius:16px;font-size:13px;font-weight:500;letter-spacing:0.25px;margin:4px 8px 4px 0;background:var(--gc-green);">GA</span>
          <span class="badge" style="background: var(--gc-orange); color: #FFFFFF;">Cloud Run</span>
        </div>
      </div>
      <div class="subtitle">2026-02-11</div>
    </div>

    <!-- Overview -->
    <div class="section">
      <h2>&#128203; 概要</h2>
      <p>
        Cloud Deploy で <span class="highlight">Cloud Run ワーカープール</span> へのコンテナワークロードのデプロイが GA (一般提供) になった。Cloud Run ワーカープールは、HTTP リクエストの処理に依存しないワークロード向けに設計された Cloud Run リソースであり、<strong>Kafka コンシューマー</strong>や <strong>Pub/Sub プルサブスクライバー</strong>などのプルベースのバックグラウンド処理に最適化されている。
      </p>
      <p>
        今回の GA 昇格により、Cloud Deploy のすべての機能 (カナリアデプロイ、デプロイ検証、自動化ルールなど) がワーカープールのデプロイにも利用可能となった。マイクロサービスアーキテクチャにおけるバックグラウンドワークロードの継続的デリバリーを自動化したい <strong>DevOps エンジニア</strong>や<strong>プラットフォームエンジニア</strong>が主な対象ユーザーとなる。
      </p>

      <!-- Before/After -->
      <div class="before-after">
        <div class="before-card">
          <h3>&#10060; Before (Preview)</h3>
          <ul>
            <li>SLA が適用されず、プロダクション環境での利用にリスクがあった</li>
            <li><code>run.googleapis.com/launch-stage: BETA</code> アノテーションの明示的な指定が必要だった</li>
            <li>GA レベルのサポートが提供されておらず、本番環境でのデプロイパイプラインに組み込むことにリスクがあった</li>
          </ul>
        </div>
        <div class="after-card">
          <h3>&#9989; After (GA)</h3>
          <ul>
            <li>SLA の適用対象としてプロダクション環境での利用が可能に</li>
            <li>Cloud Deploy の全機能 (カナリアデプロイ、デプロイ検証、並列デプロイ、自動化ルール) が利用可能に</li>
            <li>Cloud Run サービス、ジョブ、ワーカープールの 3 種類を統一パイプラインで管理可能に</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Stats -->
    <div class="stat-grid">
      <div class="stat-card green">
        <div class="stat-value">3</div>
        <div class="stat-label">Cloud Run リソースタイプ<br/>(サービス / ジョブ / ワーカープール)</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">3</div>
        <div class="stat-label">カナリア戦略<br/>(自動 / カスタム自動 / フルカスタム)</div>
      </div>
      <div class="stat-card orange">
        <div class="stat-value">10</div>
        <div class="stat-label">最大コンテナ数<br/>(1 インスタンスあたり)</div>
      </div>
      <div class="stat-card purple">
        <div class="stat-value">46%</div>
        <div class="stat-label">最大割引率<br/>(3 年 Flexible CUD)</div>
      </div>
    </div>

    <!-- Architecture Diagram -->
    <div class="section">
      <h2>&#128736;&#65039; アーキテクチャ図</h2>
      <p>CI/CD パイプラインから Cloud Deploy を経由して Cloud Run ワーカープールにデプロイされるまでのエンドツーエンドのフローを示す。</p>
      <div class="mermaid-container">
        <pre class="mermaid">
flowchart TD
    subgraph CI["&#9881;&#65039; CI/CD パイプライン"]
        direction LR
        SCM(["&#128230; ソースコード&lt;br/&gt;リポジトリ"])
        Build["&#128296; Cloud Build&lt;br/&gt;コンテナビルド"]
        AR[("&#128451;&#65039; Artifact Registry&lt;br/&gt;コンテナイメージ")]
        SCM --> Build --> AR
    end

    subgraph CDP["&#128640; Cloud Deploy"]
        direction LR
        Pipeline["&#128203; デリバリー&lt;br/&gt;パイプライン"]
        Release["&#128221; リリース"]
        Rollout["&#128260; ロールアウト"]
        Pipeline --> Release --> Rollout
    end

    subgraph Targets["&#127919; デプロイターゲット"]
        direction LR
        Dev["&#128994; Dev&lt;br/&gt;ワーカープール"]
        Staging["&#128993; Staging&lt;br/&gt;ワーカープール"]
        Prod["&#128308; Prod&lt;br/&gt;ワーカープール"]
        Dev ~~~ Staging ~~~ Prod
    end

    subgraph Runtime["&#9729;&#65039; Cloud Run ワーカープール"]
        direction LR
        WP1[("&#128232; Kafka&lt;br/&gt;コンシューマー")]
        WP2[("&#128236; Pub/Sub&lt;br/&gt;プルサブスクライバー")]
        WP3[("&#9889; バックグラウンド&lt;br/&gt;プロセッサー")]
        WP1 ~~~ WP2 ~~~ WP3
    end

    AR -.-> CDP
    Rollout --> Dev
    Dev -->|"プロモーション"| Staging
    Staging -->|"プロモーション"| Prod
    Prod --> Runtime

    classDef ci fill:#E8F1FF,stroke:#4A90E2,stroke-width:2px,color:#333333
    classDef deploy fill:#E9F7EC,stroke:#66BB6A,stroke-width:2px,color:#333333
    classDef target fill:#FFF3E0,stroke:#FF9800,stroke-width:2px,color:#333333
    classDef runtime fill:#F3E5F5,stroke:#7B61FF,stroke-width:2px,color:#333333
    classDef group fill:none,stroke:#CCCCCC,stroke-width:2px,color:#666666

    class SCM,Build ci
    class AR ci
    class Pipeline,Release,Rollout deploy
    class Dev,Staging,Prod target
    class WP1,WP2,WP3 runtime
    class CI,CDP,Targets,Runtime group
        </pre>
      </div>
      <p>Cloud Deploy のデリバリーパイプラインにより、Dev、Staging、Prod の各環境へのプロモーションが管理される。</p>
    </div>

    <!-- Key Features -->
    <div class="section">
      <h2>&#11088; 主要機能</h2>

      <div class="card">
        <h3>&#128230; Cloud Run ワーカープールのデプロイサポート</h3>
        <div class="check-item"><span class="check-icon">&#10003;</span><span>Cloud Deploy から <code>workerpool.yaml</code> を使用して Cloud Run ワーカープールを直接デプロイ可能</span></div>
        <div class="check-item"><span class="check-icon">&#10003;</span><span><code>skaffold.yaml</code> の <code>manifests.rawYaml</code> にワーカープール定義ファイルを指定するだけで設定完了</span></div>
        <div class="check-item"><span class="check-icon">&#10003;</span><span>新規ワーカープールの作成と既存ワーカープールのリビジョン更新の両方に対応</span></div>
      </div>

      <div class="card card-green">
        <h3>&#128037; カナリアデプロイ対応</h3>
        <div class="check-item"><span class="check-icon">&#10003;</span><span>Cloud Run ワーカープールでカナリアデプロイ戦略が利用可能 (Cloud Run ジョブではカナリアデプロイは非対応)</span></div>
        <div class="check-item"><span class="check-icon">&#10003;</span><span>トラフィック分割ではなく、<strong>インスタンス数のリビジョン間分割</strong>によりカナリアを実現</span></div>
        <div class="check-item"><span class="check-icon">&#10003;</span><span>自動カナリア、カスタム自動カナリア、フルカスタムカナリアの 3 種類に対応</span></div>
      </div>

      <div class="card card-purple">
        <h3>&#128279; 統一されたデリバリーパイプライン管理</h3>
        <div class="check-item"><span class="check-icon">&#10003;</span><span>Cloud Run サービス、ジョブ、ワーカープールを同一の Cloud Deploy パイプラインで管理</span></div>
        <div class="check-item"><span class="check-icon">&#10003;</span><span>プロモーション、承認ワークフロー、デプロイ検証、自動化ルールがワーカープールにも適用</span></div>
        <div class="check-item"><span class="check-icon">&#10003;</span><span>マルチターゲット (並列デプロイ) もサポート</span></div>
      </div>
    </div>

    <!-- Technical Specs -->
    <div class="section">
      <h2>&#128295; 技術仕様</h2>

      <h3>ワーカープール定義 (workerpool.yaml)</h3>
      <table>
        <thead>
          <tr><th>項目</th><th>詳細</th></tr>
        </thead>
        <tbody>
          <tr><td>API バージョン</td><td><code>run.googleapis.com/v1</code></td></tr>
          <tr><td>Kind</td><td><code>WorkerPool</code></td></tr>
          <tr><td>スケーリング</td><td>手動スケーリング (自動スケーリングは非対応)</td></tr>
          <tr><td>ロードバランシング</td><td>なし (エンドポイント/URL なし)</td></tr>
          <tr><td>VPC 接続</td><td>Direct VPC Egress/Ingress サポート</td></tr>
          <tr><td>サイドカー</td><td>最大 10 コンテナ/インスタンス</td></tr>
          <tr><td>コンテナレジストリ</td><td>Artifact Registry (推奨)、Docker Hub</td></tr>
          <tr><td>gcloud CLI バージョン</td><td>541.0.0 以上が必要</td></tr>
        </tbody>
      </table>

      <h3>必要な IAM ロール</h3>
      <table>
        <thead>
          <tr><th>ロール</th><th>リソース</th></tr>
        </thead>
        <tbody>
          <tr><td><code>roles/run.developer</code></td><td>Cloud Run ワーカープール</td></tr>
          <tr><td><code>roles/iam.serviceAccountUser</code></td><td>ワーカープールのサービスアカウント</td></tr>
          <tr><td><code>roles/artifactregistry.reader</code></td><td>Artifact Registry リポジトリ</td></tr>
        </tbody>
      </table>

      <h3>Skaffold 設定例</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">YAML</span>
          <span class="code-title">skaffold.yaml</span>
        </div>
        <pre><code class="language-yaml">apiVersion: skaffold/v4beta7
kind: Config
metadata:
  name: worker-pool-application
manifests:
  rawYaml:
  - workerpool.yaml
deploy:
  cloudrun: {}</code></pre>
      </div>
    </div>

    <!-- Setup Steps -->
    <div class="section">
      <h2>&#128221; 設定方法</h2>

      <div class="note-box">
        <strong>&#128161; 前提条件:</strong> gcloud CLI 541.0.0 以上 / Cloud Deploy デリバリーパイプライン作成済み / Cloud Run API と Cloud Deploy API が有効化済み
      </div>

      <h3>ステップ 1: ターゲット定義の作成</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">YAML</span>
          <span class="code-title">target.yaml</span>
        </div>
        <pre><code class="language-yaml">apiVersion: deploy.cloud.google.com/v1
kind: Target
metadata:
  name: prod-worker
description: Production worker pool target
run:
  location: projects/my-project/locations/us-central1</code></pre>
      </div>

      <h3>ステップ 2: ワーカープール定義の作成</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">YAML</span>
          <span class="code-title">workerpool.yaml</span>
        </div>
        <pre><code class="language-yaml">apiVersion: run.googleapis.com/v1
kind: WorkerPool
metadata:
  name: my-worker-pool
spec:
  template:
    spec:
      containers:
      - image: us-docker.pkg.dev/my-project/my-repo/my-worker:latest</code></pre>
      </div>
      <div class="note-box">
        <strong>&#128161; ポイント:</strong> GA 昇格により <code>run.googleapis.com/launch-stage: BETA</code> アノテーションの指定は不要になった。
      </div>

      <h3>ステップ 3: デリバリーパイプラインの定義と登録</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">YAML</span>
          <span class="code-title">clouddeploy.yaml</span>
        </div>
        <pre><code class="language-yaml">apiVersion: deploy.cloud.google.com/v1
kind: DeliveryPipeline
metadata:
  name: worker-pool-pipeline
serialPipeline:
  stages:
  - targetId: dev-worker
    profiles:
    - dev
  - targetId: staging-worker
    profiles:
    - staging
  - targetId: prod-worker
    profiles:
    - prod</code></pre>
      </div>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">パイプラインとターゲットの登録</span>
        </div>
        <pre><code class="language-bash"># パイプラインとターゲットの登録
gcloud deploy apply --file=clouddeploy.yaml --region=us-central1</code></pre>
      </div>

      <h3>ステップ 4: リリースの作成</h3>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">Bash</span>
          <span class="code-title">リリースの作成</span>
        </div>
        <pre><code class="language-bash"># リリースを作成してデリバリーパイプラインを開始
gcloud deploy releases create release-001 \
  --delivery-pipeline=worker-pool-pipeline \
  --region=us-central1 \
  --source=./config</code></pre>
      </div>
    </div>

    <!-- Benefits -->
    <div class="section">
      <h2>&#128640; メリット</h2>

      <h3>&#128188; ビジネス面</h3>
      <div class="card card-green">
        <div class="check-item"><span class="check-icon">&#10003;</span><span><strong>プロダクション環境での信頼性向上</strong>: GA 昇格により SLA が適用され、本番環境でのバックグラウンド処理ワークロードのデプロイに対する信頼性が向上</span></div>
        <div class="check-item"><span class="check-icon">&#10003;</span><span><strong>運用コストの削減</strong>: Cloud Deploy の自動化ルール (自動プロモーション、自動ロールバック) により、運用オーバーヘッドが削減</span></div>
      </div>

      <h3>&#9889; 技術面</h3>
      <div class="card">
        <div class="check-item"><span class="check-icon">&#10003;</span><span><strong>カナリアデプロイによるリスク低減</strong>: インスタンスをリビジョン間で段階的に分割し、新バージョンのデプロイリスクを最小化</span></div>
        <div class="check-item"><span class="check-icon">&#10003;</span><span><strong>統一されたデプロイ管理</strong>: Cloud Run サービス、ジョブ、ワーカープールを 1 つのパイプラインフレームワークで一貫管理</span></div>
        <div class="check-item"><span class="check-icon">&#10003;</span><span><strong>サイドカーコンテナのサポート</strong>: 最大 10 コンテナをデプロイでき、ログ収集やメトリクスエクスポーターなどの補助コンテナ同梱が可能</span></div>
      </div>
    </div>

    <!-- Limitations -->
    <div class="section">
      <h2>&#9888;&#65039; デメリット・制約事項</h2>

      <h3>制限事項</h3>
      <div class="card card-red">
        <div class="check-item"><span class="cross-icon">&#10007;</span><span>ターゲットごとにデプロイできるのは 1 つの Cloud Run ワーカープールのみ</span></div>
        <div class="check-item"><span class="cross-icon">&#10007;</span><span>ワーカープールは自動スケーリングに対応しておらず、手動スケーリングまたは独自のオートスケーラーの実装が必要</span></div>
        <div class="check-item"><span class="cross-icon">&#10007;</span><span>インスタンス数を 0 に設定するとワーカープールは起動しない (最低 1 インスタンスが必要)</span></div>
      </div>

      <h3>考慮すべき点</h3>
      <div class="warning-box">
        <strong>&#128176; 課金に関する注意:</strong> 手動スケーリング使用時はリクエストの有無にかかわらず、すべてのインスタンスがアクティブインスタンスとして課金される。
      </div>
      <div class="card card-orange">
        <div class="check-item"><span class="arrow">&#8594;</span><span>ワーカープールにはロードバランシングされたエンドポイントがなく、外部からの HTTP リクエスト受信はできない</span></div>
        <div class="check-item"><span class="arrow">&#8594;</span><span>独自のオートスケーラーを構築する場合、Workflows との連携 (REST API 経由でのインスタンス数更新) を検討する必要がある</span></div>
      </div>
    </div>

    <!-- Use Cases -->
    <div class="section">
      <h2>&#128161; ユースケース</h2>

      <div class="usecase-card">
        <h4>&#128232; ユースケース 1: Kafka コンシューマーのデプロイパイプライン</h4>
        <p><strong>シナリオ:</strong> イベント駆動アーキテクチャにおいて、Kafka トピックからメッセージを継続的に取得して処理するコンシューマーワークロードを、開発環境から本番環境まで段階的にデプロイする。</p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">YAML</span>
            <span class="code-title">カナリアデプロイ設定例</span>
          </div>
          <pre><code class="language-yaml"># clouddeploy.yaml
apiVersion: deploy.cloud.google.com/v1
kind: DeliveryPipeline
metadata:
  name: kafka-consumer-pipeline
serialPipeline:
  stages:
  - targetId: dev
    profiles: [dev]
  - targetId: staging
    profiles: [staging]
  - targetId: prod
    profiles: [prod]
    strategy:
      canary:
        runtimeConfig:
          cloudRun:
            automaticTrafficControl: true
        canaryDeployment:
          percentages: [25, 50, 75]
          verify: true</code></pre>
        </div>
        <p><strong>効果:</strong> カナリアデプロイにより、本番環境のインスタンスを 25%、50%、75% と段階的に新リビジョンに切り替え、メッセージ処理の安定性を確認しながら安全にデプロイ可能。</p>
      </div>

      <div class="usecase-card">
        <h4>&#128236; ユースケース 2: Pub/Sub プルサブスクライバーの管理</h4>
        <p><strong>シナリオ:</strong> 大量のイベントを処理する Pub/Sub プルサブスクライバーを Cloud Run ワーカープールとしてデプロイし、Workflows を使用して需要に応じたスケーリングを自動化する。</p>
        <p><strong>効果:</strong> Cloud Deploy による一貫したデプロイプロセスと Workflows による動的なインスタンス数調整を組み合わせることで、運用の自動化とコスト最適化を両立可能。</p>
      </div>
    </div>

    <!-- Pricing -->
    <div class="section">
      <h2>&#128176; 料金</h2>

      <h3>Cloud Deploy の料金</h3>
      <table>
        <thead>
          <tr><th>項目</th><th>料金</th></tr>
        </thead>
        <tbody>
          <tr><td>最初のアクティブなマルチターゲットデリバリーパイプライン (請求アカウントごと)</td><td><strong>無料</strong></td></tr>
          <tr><td>追加のアクティブなマルチターゲットデリバリーパイプライン</td><td>$5/月</td></tr>
          <tr><td>シングルターゲットのデリバリーパイプライン</td><td><strong>無料</strong></td></tr>
        </tbody>
      </table>
      <p style="font-size: 14px;">「アクティブ」なパイプラインとは、請求月中にリリースまたはロールアウトが 1 つ以上作成されたパイプラインを指す。Cloud Build、Cloud Storage、Cloud Audit Logs などの依存サービスの料金も別途発生する。</p>

      <h3>Cloud Run ワーカープールの料金</h3>
      <p>Cloud Run ワーカープールはインスタンスベースの課金。手動スケーリング使用時は、リクエスト処理の有無にかかわらずすべてのインスタンスがアクティブインスタンスとして課金される。</p>

      <div class="stat-grid">
        <div class="stat-card green">
          <div class="stat-value">28%</div>
          <div class="stat-label">Flexible CUD 割引<br/>(1 年契約)</div>
        </div>
        <div class="stat-card purple">
          <div class="stat-value">46%</div>
          <div class="stat-label">Flexible CUD 割引<br/>(3 年契約)</div>
        </div>
      </div>
    </div>

    <!-- Regions -->
    <div class="section">
      <h2>&#127758; 利用可能リージョン</h2>
      <p>Cloud Run ワーカープールは Cloud Run がサポートするすべてのリージョンで利用可能。代表的なリージョンは以下の通り。</p>

      <h3>Tier 1 料金リージョン</h3>
      <div class="region-chips">
        <span class="region-chip">&#127471;&#127477; asia-northeast1 (東京)</span>
        <span class="region-chip">&#127471;&#127477; asia-northeast2 (大阪)</span>
        <span class="region-chip">&#127482;&#127480; us-central1 (アイオワ)</span>
        <span class="region-chip">&#127482;&#127480; us-east1 (サウスカロライナ)</span>
        <span class="region-chip">&#127466;&#127482; europe-west1 (ベルギー)</span>
      </div>

      <h3>Tier 2 料金リージョン</h3>
      <div class="region-chips">
        <span class="region-chip tier2">&#127472;&#127479; asia-northeast3 (ソウル)</span>
        <span class="region-chip tier2">&#127480;&#127468; asia-southeast1 (シンガポール)</span>
        <span class="region-chip tier2">&#127462;&#127482; australia-southeast1 (シドニー)</span>
        <span class="region-chip tier2">&#127465;&#127466; europe-west3 (フランクフルト)</span>
      </div>
    </div>

    <!-- Related Services -->
    <div class="section">
      <h2>&#128279; 関連サービス・機能</h2>
      <div class="related-grid">
        <div class="related-item">
          <strong>&#9729;&#65039; Cloud Run</strong>
          <span>ワーカープールのランタイム環境</span>
        </div>
        <div class="related-item">
          <strong>&#128295; Skaffold</strong>
          <span>マニフェストのレンダリング</span>
        </div>
        <div class="related-item">
          <strong>&#128451;&#65039; Artifact Registry</strong>
          <span>コンテナイメージ管理</span>
        </div>
        <div class="related-item">
          <strong>&#128296; Cloud Build</strong>
          <span>CI パイプライン実行環境</span>
        </div>
        <div class="related-item">
          <strong>&#9881;&#65039; Workflows</strong>
          <span>カスタムオートスケーラー構築</span>
        </div>
      </div>
    </div>

    <!-- Reference Links -->
    <div class="section">
      <h2>&#128206; 参考リンク</h2>
      <ul class="links-list">
        <li>&#128196; <a href="https://cloud.google.com/release-notes#February_11_2026" target="_blank" rel="noopener noreferrer">公式リリースノート</a></li>
        <li>&#128640; <a href="https://cloud.google.com/deploy/docs/run-targets" target="_blank" rel="noopener noreferrer">Cloud Deploy から Cloud Run へのデプロイ</a></li>
        <li>&#128230; <a href="https://cloud.google.com/run/docs/deploy-worker-pools" target="_blank" rel="noopener noreferrer">Cloud Run ワーカープールのデプロイ</a></li>
        <li>&#9729;&#65039; <a href="https://cloud.google.com/run/docs/overview/what-is-cloud-run" target="_blank" rel="noopener noreferrer">Cloud Run ワーカープールの概要</a></li>
        <li>&#128295; <a href="https://cloud.google.com/run/docs/configuring/workerpools/manual-scaling" target="_blank" rel="noopener noreferrer">Cloud Run ワーカープールの手動スケーリング</a></li>
        <li>&#128037; <a href="https://cloud.google.com/deploy/docs/deployment-strategies/canary/cloud-run" target="_blank" rel="noopener noreferrer">Cloud Deploy カナリアデプロイ (Cloud Run)</a></li>
        <li>&#128176; <a href="https://cloud.google.com/deploy/pricing" target="_blank" rel="noopener noreferrer">Cloud Deploy 料金ページ</a></li>
        <li>&#128176; <a href="https://cloud.google.com/run/pricing" target="_blank" rel="noopener noreferrer">Cloud Run 料金ページ</a></li>
      </ul>
    </div>

    <!-- Summary -->
    <div class="section" style="background: var(--gc-blue-tint); border: 2px solid var(--gc-blue-300);">
      <h2>&#128203; まとめ</h2>
      <p>
        Cloud Deploy で Cloud Run ワーカープールへのデプロイが GA になったことで、Kafka コンシューマーや Pub/Sub プルサブスクライバーなどの<span class="highlight">非 HTTP バックグラウンドワークロード</span>に対しても、カナリアデプロイやデプロイ検証を含む本格的な継続的デリバリーパイプラインを構築できるようになった。
      </p>
      <p>
        プロダクション環境でバックグラウンド処理ワークロードを Cloud Run 上で運用しているチームは、Cloud Deploy のデリバリーパイプラインにワーカープールを組み込むことで、<strong>デプロイプロセスの標準化と安全性の向上</strong>を実現することを推奨する。
      </p>
    </div>

    <!-- Footer -->
    <footer>
      <p>&#128206; 出典:</p>
      <ul style="list-style: none; padding: 0; margin: 4px 0;">
        <li style="margin: 4px 0;"><a href="https://cloud.google.com/release-notes#February_11_2026" target="_blank" rel="noopener noreferrer">https://cloud.google.com/release-notes#February_11_2026</a></li>
        <li style="margin: 4px 0;"><a href="https://cloud.google.com/deploy/docs/run-targets" target="_blank" rel="noopener noreferrer">https://cloud.google.com/deploy/docs/run-targets</a></li>
        <li style="margin: 4px 0;"><a href="https://cloud.google.com/run/docs/deploy-worker-pools" target="_blank" rel="noopener noreferrer">https://cloud.google.com/run/docs/deploy-worker-pools</a></li>
      </ul>
      <p style="margin-top: 12px; font-size: 11px; color: var(--gc-outline);">
        #CloudDeploy #CloudRun #WorkerPool #GA #ContinuousDelivery #CanaryDeployment #BackgroundProcessing #Kafka #PubSub
      </p>
    </footer>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'base',
      themeVariables: {
        primaryColor: '#4285F4',
        primaryTextColor: '#202124',
        primaryBorderColor: '#4285F4',
        lineColor: '#4285F4',
        secondaryColor: '#F1F3F4',
        tertiaryColor: '#FAFAFA',
        background: '#FFFFFF',
        mainBkg: '#E8F0FE',
        nodeBorder: '#4285F4',
        clusterBkg: '#E8F0FE',
        clusterBorder: '#4285F4',
        edgeLabelBackground: '#FFFFFF',
        textColor: '#202124'
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</body>
</html>